<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>TEEP-DEVICE: Build TEEP-Device with Docker</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">TEEP-DEVICE
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('a00066.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Build TEEP-Device with Docker </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >The benefit of Docker images is to provide the environment of building and developing TEEP-Device to reduce the overhead of preparing them individually.</p>
<p >The TEEP-Device requires TA-Ref which provides a unified SDK among different TEEs for three CPU architectures, Keystone for RISC-V, OP-TEE for Arm64 and SGX for Intel.</p>
<p >Without the prepared Docker images, the developer will be required to build a massing software stack of Keystone, OP-TEE and SGX and install them on his/her development machine which needs downloading large sizes of source codes, a long time for building them. Also it may result in every individual having a slightly different environment which makes it difficult to reproduce when encountering errors.</p>
<p >The Docker images provide an easy to prepare development environment for TEEP-Device.</p>
<h1><a class="anchor" id="autotoc_md18"></a>
Preparation for Docker</h1>
<p >To build the TEEP-Device with Docker, it is required to install Docker on Ubuntu.</p>
<p >For the first time users of Docker, please have a look on <a href="https://docs.docker.com/engine/">https://docs.docker.com/engine/</a>.</p>
<p >The following installation steps is for Ubuntu 20.04</p>
<h2><a class="anchor" id="autotoc_md19"></a>
Install Docker</h2>
<div class="fragment"><div class="line">$ sudo apt update</div>
<div class="line"> </div>
<div class="line"># Next, install a few prerequisite packages which let apt use packages over HTTPS:</div>
<div class="line">$ sudo apt install apt-transport-https ca-certificates curl software-properties-common</div>
<div class="line"> </div>
<div class="line"># Then add the GPG key for the official Docker repository to your system:</div>
<div class="line">$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</div>
<div class="line"> </div>
<div class="line"># Add the Docker repository to APT sources:</div>
<div class="line">$ sudo add-apt-repository &quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu focal stable&quot;</div>
<div class="line"> </div>
<div class="line"># This will also update our package database with the Docker packages from the newly added repo.</div>
<div class="line"># Make sure you are about to install from the Docker repo instead of the default Ubuntu repo:</div>
<div class="line">$ apt-cache policy docker-ce</div>
<div class="line"> </div>
<div class="line">#Finally, install Docker</div>
<div class="line">$ sudo apt install docker-ce docker-compose</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md20"></a>
Executing Docker without sudo</h2>
<p >By default, the Docker command can only be run by the root user or by a user in the Docker group, which is automatically created during Docker's installation process. If you attempt to run the Docker command without prefixing it with sudo or without being in the Docker group, you will get an output like this:</p>
<div class="fragment"><div class="line">docker: Cannot connect to the Docker daemon. Is the docker daemon running on this host?.</div>
</div><!-- fragment --><p >To avoid typing sudo whenever we run the docker command, add your username to the docker group.</p>
<div class="fragment"><div class="line">$ sudo groupadd docker</div>
<div class="line"> </div>
<div class="line">$ sudo gpasswd -a $USER docker</div>
<div class="line"> </div>
<div class="line"># Logout and then log-in again to apply the changes to the group</div>
</div><!-- fragment --><p >After you logout and login, you can probably run the Docker command without <code>sudo</code>.</p>
<div class="fragment"><div class="line">$ docker run hello-world</div>
</div><!-- fragment --><p >Login to the docker to be able to access docker images. Make sure you have an account on docker-hub. If not please create one on <code>dockerhub.com</code>.</p>
<div class="fragment"><div class="line">$ docker login -u ${YOUR_USERNAME} -p ${YOUR_PASSWD}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md21"></a>
Create a Docker network tamproto</h2>
<p >A Docker network named tamproto is required when we run TEEP-Device. The local network is required to connect with tamproto service running locally.</p>
<div class="fragment"><div class="line">$ docker network create tamproto_default</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md22"></a>
Docker Images with pre-built TEEP-Device</h1>
<p >The following are the docker images that have pre-built binaries of TEEP-Device with TA-Ref. Since these images are already prepared and built already, you can start using it directly without building the TEEP-Device oneself.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Purpose   </th><th class="markdownTableHeadNone">Docker image   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Keystone   </td><td class="markdownTableBodyNone">aistcpsec/teep-dev:keystone   </td><td class="markdownTableBodyNone">Has pre-built binaries of TEEP-Device with TA-Ref for RISC-V Keystone    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">OP-TEE   </td><td class="markdownTableBodyNone">aistcpsec/teep-dev:optee   </td><td class="markdownTableBodyNone">Has pre-built binaries of TEEP-Device with TA-Ref for ARM OP-TEE    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Intel SGX   </td><td class="markdownTableBodyNone">aistcpsec/teep-dev:sgx   </td><td class="markdownTableBodyNone">Has pre-built binaries of TEEP-Device with TA-Ref for Intel SSX    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">tamproto   </td><td class="markdownTableBodyNone">aistcpsec/teep-dev:tamproto   </td><td class="markdownTableBodyNone">Used for running tamproto    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Doxygen   </td><td class="markdownTableBodyNone">aistcpsec/teep-dev:doxygen   </td><td class="markdownTableBodyNone">Used for generating TEEP-Device documentation   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md23"></a>
Preparation to build TEEP-Device on Docker</h1>
<h2><a class="anchor" id="autotoc_md24"></a>
List of Docker images to build TEEP-Device</h2>
<p >It requires Docker images of TA-Ref for building the TEEP-Device since TEEP-Device is developed on top of TA-Ref SDK. The TEEP-Device is one of the applications of TA-Ref.</p>
<p >Docker images have all necessary development packages for building TEEP-Device for all three TEEs. The instructions of usage are described from the next chapters.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Purpose   </th><th class="markdownTableHeadNone">Docker image    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Keystone   </td><td class="markdownTableBodyNone">aistcpsec/taref-dev:keystone    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">OP-TEE   </td><td class="markdownTableBodyNone">aistcpsec/taref-dev:optee    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Intel SGX   </td><td class="markdownTableBodyNone">aistcpsec/taref-dev:sgx   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md25"></a>
Run tamproto (TAM Server) - Required by all Keystone/OP-TEE/SGX</h1>
<p >To run TEEP-Device, first we need to run tamproto inside the same host. Let's clone the tamproto and start it.</p>
<p ><b>Running tamproto</b></p>
<p >Open the first terminal for the tamproto.</p>
<div class="fragment"><div class="line"># Clone the tamproto repo and checkout master branch</div>
<div class="line">$ git clone https://github.com/ko-isobe/tamproto.git</div>
<div class="line">$ cd tamproto</div>
<div class="line">$ git checkout fb1961bc964857384c9ed8696c0d5fc0a76a319d</div>
<div class="line">$ docker-compose build</div>
<div class="line">$ docker-compose up</div>
</div><!-- fragment --><p >Trimmed output of starting tamproto </p><div class="fragment"><div class="line">tam_api_1  |   TEE_pub: &#39;teep.jwk&#39; }</div>
<div class="line">tam_api_1  | Load key TAM_priv</div>
<div class="line">tam_api_1  | Load key TAM_pub</div>
<div class="line">tam_api_1  | Load key TEE_priv</div>
<div class="line">tam_api_1  | Load key TEE_pub</div>
<div class="line">tam_api_1  | Key binary loaded</div>
<div class="line">tam_api_1  | 192.168.11.4</div>
<div class="line">tam_api_1  | Express HTTP  server listening on port 8888</div>
<div class="line">tam_api_1  | Express HTTPS server listening on port 8443</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md26"></a>
Build TEEP-Device for Keystone with Docker</h2>
<p ><b>Clone TEEP-Device</b></p>
<p >Open the second terminal for editing the sources of TEEP-Device. The directory of cloning sources is mounted when running Docker in the next step.</p>
<div class="fragment"><div class="line"># Clone the teep-device repo and checkout master branch</div>
<div class="line">$ git clone https://github.com/mcd500/teep-device.git</div>
<div class="line">$ cd teep-device</div>
<div class="line">$ git checkout master</div>
<div class="line"> </div>
<div class="line"># Sync and update the submodules</div>
<div class="line">$ git submodule sync --recursive</div>
<div class="line">$ git submodule update --init --recursive</div>
</div><!-- fragment --><p >Match the user privilege with the one used in the container to prevent permission errors when editing sources. Container uses a build-user account with 1000:1000.</p>
<div class="fragment"><div class="line"># Return back to parent directory of teep-device</div>
<div class="line">$ sudo chown -R 1000:1000 teep-device/</div>
<div class="line">$ sudo chmod -R a+w teep-device/</div>
<div class="line">$ git config --global --add safe.directory $(pwd)/teep-device</div>
</div><!-- fragment --><p ><b>Start the Docker</b></p>
<p >Open the third terminal. Here we build the TEEP-Device and run it to communicate with tamproto opened on the first terminal. If any error occurs, edit the sources on the second terminal to debug.</p>
<div class="fragment"><div class="line"># Change the directory into teep-device before starting the docker</div>
<div class="line"># Start the docker</div>
<div class="line">$ docker run --network tamproto_default -w /home/user/teep-device -it --rm -v $(pwd):/home/user/teep-device aistcpsec/taref-dev:keystone</div>
</div><!-- fragment --><p >After you start the Docker command, you will be logged-in inside the Docker container. Following are the commands to be executed inside the Docker.</p>
<p ><b>Build</b></p>
<div class="fragment"><div class="line"># [Inside docker image]</div>
<div class="line"> </div>
<div class="line"># Change to teep-device</div>
<div class="line">$ cd ~/teep-device/</div>
<div class="line"> </div>
<div class="line"># Build the teep-device</div>
<div class="line">$ make</div>
<div class="line"> </div>
<div class="line"># Trimmed output of make command</div>
<div class="line">....</div>
<div class="line">make -C sample rootfs TAM_URL=http://tamproto_tam_api_1:8888</div>
<div class="line">make[1]: Entering directory &#39;/home/user/teep-device/sample&#39;</div>
<div class="line">cp /home/user/keystone/build/buildroot.build/images/rootfs.ext2</div>
<div class="line">     /home/user/teep-device/sample/../build/keystone/rootfs.ext2</div>
<div class="line">e2mkdir -O root -G root /home/user/teep-device/sample/../build/keystone/rootfs.ext2:/root/teep-broker</div>
<div class="line">e2cp -O root -G root -p /home/user/teep-device/sample/../build/keystone/hello-tc/App-keystone</div>
<div class="line">         /home/user/teep-device/sample/../build/keystone/rootfs.ext2:/root/teep-broker/hello-app</div>
<div class="line">e2cp -O root -G root -p /home/user/teep-device/sample/../build/keystone/agent/teep-agent-ta </div>
<div class="line">        /home/user/teep-device/sample/../build/keystone/rootfs.ext2:/root/teep-broker</div>
<div class="line">e2cp -O root -G root -p /home/user/teep-device/sample/../build/keystone/broker/teep-broker-app </div>
<div class="line">        /home/user/teep-device/sample/../build/keystone/rootfs.ext2:/root/teep-broker</div>
<div class="line">e2cp -O root -G root -p /home/user/teep-device/sample/../build/keystone/scripts/env.sh </div>
<div class="line">        /home/user/teep-device/sample/../build/keystone/rootfs.ext2:/root/teep-broker</div>
<div class="line">e2cp -O root -G root -p /home/user/teep-device/sample/../build/keystone/scripts/itc.sh </div>
<div class="line">        /home/user/teep-device/sample/../build/keystone/rootfs.ext2:/root/teep-broker</div>
<div class="line">e2cp -O root -G root -p /home/user/teep-device/sample/../build/keystone/scripts/rtc.sh </div>
<div class="line">        /home/user/teep-device/sample/../build/keystone/rootfs.ext2:/root/teep-broker</div>
<div class="line">e2cp -O root -G root -p /home/user/teep-device/sample/../build/keystone/scripts/showtamurl.sh </div>
<div class="line">        /home/user/teep-device/sample/../build/keystone/rootfs.ext2:/root/teep-broker</div>
<div class="line">e2cp -O root -G root -p /home/user/teep-device/sample/../build/keystone/scripts/get-ip.sh </div>
<div class="line">        /home/user/teep-device/sample/../build/keystone/rootfs.ext2:/root/teep-broker</div>
<div class="line">e2cp -O root -G root -p /home/user/teep-device/sample/../build/keystone/scripts/cp_ta_to_tamproto.sh </div>
<div class="line">        /home/user/teep-device/sample/../build/keystone/rootfs.ext2:/root/teep-broker</div>
<div class="line">e2cp -O root -G root -p /home/user/keystone/sdk/build64/runtime/eyrie-rt </div>
<div class="line">        /home/user/teep-device/sample/../build/keystone/rootfs.ext2:/root/teep-broker</div>
<div class="line">e2cp -O root -G root -p /home/user/teep-device/sample/../build/keystone/ree/mbedtls/library/lib* </div>
<div class="line">        /home/user/teep-device/sample/../build/keystone/rootfs.ext2:/usr/lib</div>
<div class="line">e2cp -O root -G root -p /home/user/teep-device/sample/../build/keystone/ree/libwebsockets/lib/lib* </div>
<div class="line">        /home/user/teep-device/sample/../build/keystone/rootfs.ext2:/usr/lib</div>
<div class="line"> </div>
<div class="line">make[1]: Leaving directory &#39;/home/user/teep-device/sample&#39;</div>
</div><!-- fragment --><p ><b>Run manually</b></p>
<p >After the successful build, run the sample TEEP session with tamproto.</p>
<p >Launch qemu of RISC-V with Keystone. The password for root is 'sifive'</p>
<div class="fragment"><div class="line">$ make run-qemu</div>
<div class="line"> </div>
<div class="line">make -C sample run-qemu TAM_URL=http://tamproto_tam_api_1:8888</div>
<div class="line">make[1]: Entering directory &#39;/home/user/teep-device/sample&#39;</div>
<div class="line">qemu-system-riscv64 \</div>
<div class="line">    -m 4G \</div>
<div class="line">    -bios /home/user/keystone/build/bootrom.build/bootrom.bin \</div>
<div class="line">    -nographic \</div>
<div class="line">    -machine virt \</div>
<div class="line">    -kernel /home/user/keystone/build/sm.build/platform/generic/firmware/fw_payload.elf \</div>
<div class="line">    -append &quot;console=ttyS0 ro root=/dev/vda cma=256M@0x00000000C0000000&quot; \</div>
<div class="line">    -device virtio-blk-device,drive=hd0</div>
<div class="line">    -drive file=/home/user/teep-device/sample/../build/keystone/rootfs.ext2,format=raw,id=hd0 \</div>
<div class="line">    -netdev user,id=net0,net=192.168.100.1/24,dhcpstart=192.168.100.128,hostfwd=tcp::10032-:22 \</div>
<div class="line">    -device virtio-net-device,netdev=net0 \</div>
<div class="line">    -device virtio-rng-pci</div>
<div class="line">overriding secure boot ROM (file: /home/user/keystone/build/bootrom.build/bootrom.bin)</div>
<div class="line">boot ROM size: 53869</div>
<div class="line">fdt dumped at 57968</div>
<div class="line"> </div>
<div class="line">OpenSBI v0.8</div>
<div class="line"> </div>
<div class="line">.....</div>
<div class="line"> </div>
<div class="line">Starting dropbear sshd: OK</div>
<div class="line"> </div>
<div class="line">Welcome to Buildroot</div>
<div class="line">buildroot login: root</div>
<div class="line">Password: </div>
<div class="line">#</div>
</div><!-- fragment --><p >Please enter login username and password as root and sifive.</p>
<p >After login, start from installing the driver for Keystone.</p>
<div class="fragment"><div class="line"># ls</div>
<div class="line">keystone-driver.ko  teep-broker         tests.ke</div>
<div class="line"># cd teep-broker/</div>
<div class="line"># ls</div>
<div class="line">cp_ta_to_tamproto.sh  hello-app             showtamurl.sh</div>
<div class="line">env.sh                hello-ta              teep-agent-ta</div>
<div class="line">eyrie-rt              itc.sh                teep-broker-app</div>
<div class="line">get-ip.sh             rtc.sh</div>
<div class="line"># source env.sh</div>
<div class="line">[  388.139452] keystone_driver: loading out-of-tree module taints kernel.</div>
<div class="line">[  388.146850] keystone_enclave: keystone enclave v1.0.0</div>
</div><!-- fragment --><p >There are helper scripts to handle the teep-broker. Following are the few of them and its usage.</p>
<ul>
<li>showtamurl.sh</li>
<li>itc.sh</li>
<li>rtc.sh</li>
</ul>
<p ><em>showtamurl.sh</em></p>
<p >This script prints out the tamproto values which has to be suffixed when we execute the built teep-broker-app. This script gets the url of the Tamproto either from the TAM_URL env variable or by internally executing get-ip.sh (get-ip.sh returns the IP of tamproto running in the same machine)</p>
<p >example:</p>
<div class="fragment"><div class="line">$ ./showtamurl.sh </div>
<div class="line">--tamurl 192.168.100.114/api/tam_cbor</div>
</div><!-- fragment --><p >You can simply copy the output of the showtamurl.sh and paste it to the end of the generated teep-broker-app binary.For ex:</p>
<div class="fragment"><div class="line">$ ./teep-broker-app --tamurl http://192.168.100.114:8888/api/tam_cbor</div>
</div><!-- fragment --><p ><em>itc.sh</em></p>
<p >Initiate teep-agent with tamproto. This script is for debugging the confirmative and handling of formats of TEEP Messages and SUIT Manifest in teep-agent and tamproto. Make sure you have copied the below files into tamproto server before running the ./teep-broker-app.</p>
<p >1) build/keystone/hello-tc/8d82573a-926d-4754-9353-32dc29997f74.ta <br  />
 2) build/keystone/hello-tc/signed-download-tc.suit as integrated-payload-manifest.cbor</p>
<div class="fragment"><div class="line"># cat ita.sh</div>
<div class="line">#!/bin/bash -x</div>
<div class="line"> </div>
<div class="line">./teep-broker-app --tamurl ${TAM_URL}/api/tam_cbor</div>
<div class="line"># ./itc.sh</div>
</div><!-- fragment --><p ><em>rtc.sh</em></p>
<p >Execute the downloaded TC from the tamproto. This script is for debugging the implementation of the TC.</p>
<div class="fragment"><div class="line"># ./rtc.sh</div>
<div class="line">+ echo Running downloaded TC from the TAM</div>
<div class="line">Running downloaded TC from the TAM</div>
<div class="line">+ ./hello-app 8d82573a-926d-4754-9353-32dc29997f74.ta eyrie-rt</div>
<div class="line">[debug] UTM : 0xffffffff80000000-0xffffffff80100000 (1024 KB) (boot.c:127)</div>
<div class="line">[debug] DRAM: 0x179800000-0x179c00000 (4096 KB) (boot.c:128)</div>
<div class="line">[debug] FREE: 0x1799bd000-0x179c00000 (2316 KB), va 0xffffffff001bd000 (boot.c:133)</div>
<div class="line">[debug] eyrie boot finished. drop to the user land ... (boot.c:172)</div>
<div class="line">main start</div>
<div class="line">Hello TEEP from TEE!</div>
<div class="line">main end</div>
</div><!-- fragment --><p >To exit from qemu.</p>
<div class="fragment"><div class="line"># poweroff</div>
</div><!-- fragment --><p >The log message of tamproto will be shown on the terminal of running tamproto. </p><div class="fragment"><div class="line">tam_api_1  | POST /api/tam_cbor 200 2.816 ms - 399</div>
<div class="line">tam_api_1  | Access from: ::ffff:172.18.0.3</div>
<div class="line">tam_api_1  | {</div>
<div class="line">tam_api_1  |   pragma: &#39;no-cache&#39;,</div>
<div class="line">tam_api_1  |   &#39;cache-control&#39;: &#39;no-cache&#39;,</div>
<div class="line">tam_api_1  |   host: &#39;example.com&#39;,</div>
<div class="line">tam_api_1  |   origin: &#39;http://192.168.11.3&#39;,</div>
<div class="line">tam_api_1  |   connection: &#39;close&#39;,</div>
<div class="line">tam_api_1  |   accept: &#39;application/teep+cbor&#39;,</div>
<div class="line">tam_api_1  |   &#39;content-length&#39;: &#39;13&#39;,</div>
<div class="line">tam_api_1  |   &#39;content-type&#39;: &#39;application/teep+cbor&#39;</div>
<div class="line">tam_api_1  | }</div>
<div class="line">tam_api_1  | &lt;Buffer 82 05 a1 14 48 77 77 77 77 77 77 77 77&gt;</div>
<div class="line">tam_api_1  | {</div>
<div class="line">tam_api_1  |   TYPE: 5,</div>
<div class="line">tam_api_1  |   token: &lt;Buffer 77 77 77 77 77 77 77 77&gt;,</div>
<div class="line">tam_api_1  |   TOKEN: &lt;Buffer 77 77 77 77 77 77 77 77&gt;</div>
<div class="line">tam_api_1  | }</div>
<div class="line">tam_api_1  | TAM ProcessTeepMessage instance</div>
<div class="line">tam_api_1  | TEEP-Protocol:parse</div>
<div class="line">tam_api_1  | {</div>
<div class="line">tam_api_1  |   TYPE: 5,</div>
<div class="line">tam_api_1  |   token: &lt;Buffer 77 77 77 77 77 77 77 77&gt;,</div>
<div class="line">tam_api_1  |   TOKEN: &lt;Buffer 77 77 77 77 77 77 77 77&gt;</div>
<div class="line">tam_api_1  | }</div>
<div class="line">tam_api_1  | object</div>
<div class="line">tam_api_1  | *parseSuccessMessage</div>
<div class="line">tam_api_1  | &lt;Buffer 77 77 77 77 77 77 77 77&gt;</div>
<div class="line">tam_api_1  | undefined</div>
<div class="line">tam_api_1  | TAM ProcessTeepMessage response</div>
<div class="line">tam_api_1  | undefined</div>
<div class="line">tam_api_1  | WARNING: Agent may sent invalid contents. TAM responses null.</div>
<div class="line">tam_api_1  | POST /api/tam_cbor 204 1.357 ms - -</div>
</div><!-- fragment --><p >These are trimmed outputs of all procedures above on the terminal of the running container.</p>
<div class="fragment"><div class="line">build-user@86417bb9c512:~/teep-device$ make run-qemu</div>
<div class="line">make -C sample run-qemu TAM_URL=http://tamproto_tam_api_1:8888</div>
<div class="line">make[1]: Entering directory &#39;/home/user/teep-device/sample&#39;</div>
<div class="line">qemu-system-riscv64 \</div>
<div class="line">    -m 4G \</div>
<div class="line">    -bios /home/user/keystone/build/bootrom.build/bootrom.bin \</div>
<div class="line">    -nographic \</div>
<div class="line">    -machine virt \</div>
<div class="line">    -kernel /home/user/keystone/build/sm.build/platform/generic/firmware/fw_payload.elf \</div>
<div class="line">    -append &quot;console=ttyS0 ro root=/dev/vda cma=256M@0x00000000C0000000&quot; \</div>
<div class="line">    -device virtio-blk-device,drive=hd0 -drive</div>
<div class="line">    file=/home/user/teep-device/sample/../build/keystone/rootfs.ext2,format=raw,id=hd0 \</div>
<div class="line">    -netdev user,id=net0,net=192.168.100.1/24,dhcpstart=192.168.100.128,hostfwd=tcp::10032-:22 \</div>
<div class="line">    -device virtio-net-device,netdev=net0 \</div>
<div class="line">    -device virtio-rng-pci</div>
<div class="line">overriding secure boot ROM (file: /home/user/keystone/build/bootrom.build/bootrom.bin)</div>
<div class="line">boot ROM size: 53869</div>
<div class="line">fdt dumped at 57968</div>
<div class="line"> </div>
<div class="line">OpenSBI v0.8</div>
<div class="line">   ____                    _____ ____ _____</div>
<div class="line">  / __ \                  / ____|  _ \_   _|</div>
<div class="line"> | |  | |_ __   ___ _ __ | (___ | |_) || |</div>
<div class="line"> | |  | | &#39;_ \ / _ \ &#39;_ \ \___ \|  _ &lt; | |</div>
<div class="line"> | |__| | |_) |  __/ | | |____) | |_) || |_</div>
<div class="line">  \____/| .__/ \___|_| |_|_____/|____/_____|</div>
<div class="line">        | |</div>
<div class="line">        |_|</div>
<div class="line"> </div>
<div class="line">Platform Name             : riscv-virtio,qemu</div>
<div class="line">Platform Features         : timer,mfdeleg</div>
<div class="line">Platform HART Count       : 1</div>
<div class="line">Firmware Base             : 0x80000000</div>
<div class="line">Firmware Size             : 204 KB</div>
<div class="line">Runtime SBI Version       : 0.2</div>
<div class="line"> </div>
<div class="line">Domain0 Name              : root</div>
<div class="line">Domain0 Boot HART         : 0</div>
<div class="line">Domain0 HARTs             : 0*</div>
<div class="line">Domain0 Region00          : 0x0000000080000000-0x000000008003ffff ()</div>
<div class="line">Domain0 Region01          : 0x0000000000000000-0xffffffffffffffff (R,W,X)</div>
<div class="line">Domain0 Next Address      : 0x0000000080200000</div>
<div class="line">Domain0 Next Arg1         : 0x0000000082200000</div>
<div class="line">Domain0 Next Mode         : S-mode</div>
<div class="line">Domain0 SysReset          : yes</div>
<div class="line">...</div>
<div class="line">...</div>
<div class="line">...</div>
<div class="line">Starting syslogd: OK</div>
<div class="line">Starting klogd: OK</div>
<div class="line">Running sysctl: OK</div>
<div class="line">Saving random seed: OK</div>
<div class="line">Starting network: udhcpc: started, v1.32.0</div>
<div class="line">udhcpc: sending discover</div>
<div class="line">udhcpc: sending select for 192.168.100.128</div>
<div class="line">udhcpc: lease of 192.168.100.128 obtained, lease time 86400</div>
<div class="line">deleting routers</div>
<div class="line">adding dns 192.168.100.3</div>
<div class="line">OK</div>
<div class="line">Starting dropbear sshd: OK</div>
<div class="line"> </div>
<div class="line">Welcome to Buildroot</div>
<div class="line">buildroot login: root</div>
<div class="line">Password: </div>
<div class="line"># </div>
<div class="line"># </div>
<div class="line"># ls</div>
<div class="line">keystone-driver.ko  teep-broker         tests.ke</div>
<div class="line"># cd teep-broker/</div>
<div class="line"># source env.sh </div>
<div class="line">[   18.953988] keystone_driver: loading out-of-tree module taints kernel.</div>
<div class="line">[   18.960803] keystone_enclave: keystone enclave v1.0.0</div>
<div class="line"># </div>
<div class="line"># ./itc.sh  </div>
<div class="line">+ ./teep-broker-app --tamurl http://tamproto_tam_api_1:8888/api/tam_cbor</div>
<div class="line">teep-broker.c compiled at Nov 24 2022 05:19:23</div>
<div class="line">uri = http://tamproto_tam_api_1:8888/api/tam_cbor, cose=0, talist=</div>
<div class="line">[debug] UTM : 0xffffffff80000000-0xffffffff80100000 (1024 KB) (boot.c:127)</div>
<div class="line">[debug] DRAM: 0x179800000-0x179c00000 (4096 KB) (boot.c:128)</div>
<div class="line">[debug] FREE: 0x1799f2000-0x179c00000 (2104 KB), va 0xffffffff001f2000 (boot.c:133)</div>
<div class="line">[debug] eyrie boot finished. drop to the user land ... (boot.c:172)</div>
<div class="line">[1970/01/01 00:00:37:6062] N: POST: http://tamproto_tam_api_1:8888/api/tam_cbor</div>
<div class="line">[1970/01/01 00:00:37:6073] N: (hexdump: zero length)</div>
<div class="line">[1970/01/01 00:00:37:6117] N: http://tamproto_tam_api_1:8888/api/tam_cbor</div>
<div class="line">[1970/01/01 00:00:37:6716] N: </div>
<div class="line">[1970/01/01 00:00:37:6725] N: 0000: 83 01 A5 01 81 01 03 81 00 04 43 01 02 05 14 48    ..........C....H</div>
<div class="line">[1970/01/01 00:00:37:6731] N: 0010: 77 77 77 77 77 77 77 77 15 81 00 02                wwwwwwww....    </div>
<div class="line">[1970/01/01 00:00:37:6738] N: </div>
<div class="line">[1970/01/01 00:00:37:6829] N: POST: http://tamproto_tam_api_1:8888/api/tam_cbor</div>
<div class="line">[1970/01/01 00:00:37:6843] N: </div>
<div class="line">[1970/01/01 00:00:37:6849] N: 0000: 82 02 A4 14 48 77 77 77 77 77 77 77 77 08 80 0E    ....Hwwwwwwww...</div>
<div class="line">[1970/01/01 00:00:37:6856] N: 0010: 80 0F 80                                           ...             </div>
<div class="line">[1970/01/01 00:00:37:6862] N: </div>
<div class="line">[1970/01/01 00:00:37:6907] N: http://tamproto_tam_api_1:8888/api/tam_cbor</div>
<div class="line">[1970/01/01 00:00:37:7111] N: </div>
<div class="line">[1970/01/01 00:00:37:7115] N: 0000: 82 03 A2 0A 81 59 01 66 D8 6B A2 02 58 73 82 58    .....Y.f.k..Xs.X</div>
<div class="line">[1970/01/01 00:00:37:7123] N: 0010: 24 82 2F 58 20 63 70 90 82 1C BB B2 67 95 42 78    $./X cp.....g.Bx</div>
<div class="line">[1970/01/01 00:00:37:7129] N: 0020: 7B 49 F4 5E 14 AF 0C BF AD 9E F4 A4 F0 B3 42 B9    {I.^..........B.</div>
<div class="line">[1970/01/01 00:00:37:7135] N: 0030: 23 35 56 05 AF 58 4A D2 84 43 A1 01 26 A0 F6 58    #5V..XJ..C..&amp;..X</div>
<div class="line">[1970/01/01 00:00:37:7142] N: 0040: 40 BF B8 79 C8 E0 9B DE 52 2E 84 38 10 D7 7A 2E    @..y....R..8..z.</div>
<div class="line">[1970/01/01 00:00:37:7149] N: 0050: AF 88 62 53 C1 C1 83 D6 A2 FD 9E A1 DA 6F 4A D1    ..bS.........oJ.</div>
<div class="line">[1970/01/01 00:00:37:7156] N: 0060: DD 16 84 72 BC D6 10 81 F0 AE 30 A8 05 36 91 0E    ...r......0..6..</div>
<div class="line">[1970/01/01 00:00:37:7163] N: 0070: C9 D7 63 90 B4 E9 C9 64 A1 C3 6C F0 FE 29 71 91    ..c....d..l..)q.</div>
<div class="line">[1970/01/01 00:00:37:7170] N: 0080: 84 03 58 EA A5 01 01 02 01 03 58 86 A2 02 81 84    ..X.......X.....</div>
<div class="line">[1970/01/01 00:00:37:7176] N: 0090: 4B 54 45 45 50 2D 44 65 76 69 63 65 48 53 65 63    KTEEP-DeviceHSec</div>
<div class="line">[1970/01/01 00:00:37:7182] N: 00A0: 75 72 65 46 53 50 8D 82 57 3A 92 6D 47 54 93 53    ureFSP..W:.mGT.S</div>
<div class="line">[1970/01/01 00:00:37:7188] N: 00B0: 32 DC 29 99 7F 74 42 74 61 04 58 56 86 14 A4 01    2.)..tBta.XV....</div>
<div class="line">[1970/01/01 00:00:37:7194] N: 00C0: 50 FA 6B 4A 53 D5 AD 5F DF BE 9D E6 63 E4 D4 1F    P.kJS.._....c...</div>
<div class="line">[1970/01/01 00:00:37:7201] N: 00D0: FE 02 50 14 92 AF 14 25 69 5E 48 BF 42 9B 2D 51    ..P....%i^H.B.-Q</div>
<div class="line">[1970/01/01 00:00:37:7207] N: 00E0: F2 AB 45 03 58 24 82 2F 58 20 00 11 22 33 44 55    ..E.X$./X ..3DU</div>
<div class="line">[1970/01/01 00:00:37:7213] N: 00F0: 66 77 88 99 AA BB CC DD EE FF 01 23 45 67 89 AB    fw.........#Eg..</div>
<div class="line">[1970/01/01 00:00:37:7219] N: 0100: CD EF FE DC BA 98 76 54 32 10 0E 19 87 D0 01 0F    ......vT2.......</div>
<div class="line">[1970/01/01 00:00:37:7226] N: 0110: 02 0F 09 58 54 86 13 A1 15 78 4A 68 74 74 70 3A    ...XT....xJhttp:</div>
<div class="line">[1970/01/01 00:00:37:7233] N: 0120: 2F 2F 74 61 6D 70 72 6F 74 6F 5F 74 61 6D 5F 61    //tamproto_tam_a</div>
<div class="line">[1970/01/01 00:00:37:7239] N: 0130: 70 69 5F 31 3A 38 38 38 38 2F 54 41 73 2F 38 64    pi_1:8888/TAs/8d</div>
<div class="line">[1970/01/01 00:00:37:7246] N: 0140: 38 32 35 37 33 61 2D 39 32 36 64 2D 34 37 35 34    82573a-926d-4754</div>
<div class="line">[1970/01/01 00:00:37:7253] N: 0150: 2D 39 33 35 33 2D 33 32 64 63 32 39 39 39 37 66    -9353-32dc29997f</div>
<div class="line">[1970/01/01 00:00:37:7259] N: 0160: 37 34 2E 74 61 15 02 03 0F 0A 43 82 03 0F 14 48    74.ta.....C....H</div>
<div class="line">[1970/01/01 00:00:37:7265] N: 0170: AB A1 A2 A3 A4 A5 A6 A7                            ........        </div>
<div class="line">[1970/01/01 00:00:37:7272] N: </div>
<div class="line">TTRC:verifying signature of suit manifest</div>
<div class="line">TTRC:verify OK</div>
<div class="line">TTRC:command: 20</div>
<div class="line">TTRC:execute suit-set-parameters</div>
<div class="line">TTRC:command: 1</div>
<div class="line">TTRC:execute suit-condition-vendor-identifier</div>
<div class="line">TTRC:command: 2</div>
<div class="line">TTRC:execute suit-condition-class-identifier</div>
<div class="line">TTRC:command: 19</div>
<div class="line">TTRC:execute suit-set-parameters</div>
<div class="line">TTRC:command: 21</div>
<div class="line">TTRC:execute suit-directive-fetch</div>
<div class="line">TTRC:fetch_and_store component</div>
<div class="line">[1970/01/01 00:00:38:3479] N: GET: http://tamproto_tam_api_1:8888/TAs/8d82573a-926d-4754-9353-32dc29997f74.ta</div>
<div class="line">[1970/01/01 00:00:38:3497] N: http://tamproto_tam_api_1:8888/TAs/8d82573a-926d-4754-9353-32dc29997f74.ta</div>
<div class="line">TTRC:component download 153128</div>
<div class="line">TTRC:ta-store.c: store_component() store component</div>
<div class="line">TTRC:  device   = TEEP-Device</div>
<div class="line">TTRC:  storage  = SecureFS</div>
<div class="line">TTRC:  filename = 8d82573a-926d-4754-9353-32dc29997f74.ta</div>
<div class="line">TTRC:  image_len = 153128</div>
<div class="line">TTRC:finish fetch</div>
<div class="line">TTRC:command: 3</div>
<div class="line">TTRC:execute suit-condition-image-match</div>
<div class="line">TTRC:end of command seq</div>
<div class="line">[1970/01/01 00:00:38:8690] N: POST: http://tamproto_tam_api_1:8888/api/tam_cbor</div>
<div class="line">[1970/01/01 00:00:38:8695] N: </div>
<div class="line">[1970/01/01 00:00:38:8699] N: 0000: 82 05 A1 14 48 77 77 77 77 77 77 77 77             ....Hwwwwwwww   </div>
<div class="line">[1970/01/01 00:00:38:8704] N: </div>
<div class="line">[1970/01/01 00:00:38:8714] N: http://tamproto_tam_api_1:8888/api/tam_cbor</div>
<div class="line">[1970/01/01 00:00:38:8873] N: (hexdump: zero length)</div>
<div class="line"># </div>
<div class="line"># ./rtc.sh </div>
<div class="line">+ echo Running downloaded TC from the TAM</div>
<div class="line">Running downloaded TC from the TAM</div>
<div class="line">+ ./hello-app 8d82573a-926d-4754-9353-32dc29997f74.ta eyrie-rt</div>
<div class="line">[debug] UTM : 0xffffffff80000000-0xffffffff80100000 (1024 KB) (boot.c:127)</div>
<div class="line">[debug] DRAM: 0x179800000-0x179c00000 (4096 KB) (boot.c:128)</div>
<div class="line">[debug] FREE: 0x1799bd000-0x179c00000 (2316 KB), va 0xffffffff001bd000 (boot.c:133)</div>
<div class="line">[debug] eyrie boot finished. drop to the user land ... (boot.c:172)</div>
<div class="line">main start</div>
<div class="line">Hello TEEP from TEE!</div>
<div class="line">main end</div>
<div class="line"># </div>
<div class="line"># poweroff</div>
<div class="line"># Stopping dropbear sshd: OK</div>
<div class="line">Stopping network: OK</div>
<div class="line">Saving random seed: OK</div>
<div class="line">Stopping klogd: OK</div>
<div class="line">Stopping syslogd: OK</div>
<div class="line">umount: devtmpfs busy - remounted read-only</div>
<div class="line">[  177.941806] EXT4-fs (vda): re-mounted. Opts: (null)</div>
<div class="line">The system is going down NOW!</div>
<div class="line">logout</div>
<div class="line">Sent SIGTERM to all processes</div>
<div class="line">Sent SIGKILL to all processes</div>
<div class="line">Requesting system poweroff</div>
<div class="line">[  179.965743] reboot: Power down</div>
<div class="line">make[1]: Leaving directory &#39;/home/user/teep-device/sample&#39;</div>
</div><!-- fragment --><p ><b>Run automatically</b></p>
<p >This command will run all the previous manual procedures. It is mainly prepared for running TEEP-Device in CI.</p>
<div class="fragment"><div class="line">$ make run-sample-session</div>
</div><!-- fragment --><p >Trimmed output printing 'Hello TEEP from TEE!'</p>
<div class="fragment"><div class="line">Welcome to Buildroot</div>
<div class="line">buildroot login: root</div>
<div class="line">Password: sifive</div>
<div class="line"> </div>
<div class="line"># PS1=&#39;##&#39;&#39;## &#39;</div>
<div class="line">#### insmod keystone-driver.ko || echo &#39;err&#39;&#39;or&#39;</div>
<div class="line">[    5.247409] keystone_driver: loading out-of-tree module taints kernel.</div>
<div class="line">[    5.254006] keystone_enclave: keystone enclave v1.0.0</div>
<div class="line">#### cd /root/teep-broker</div>
<div class="line">#### ls -l</div>
<div class="line">total 3422</div>
<div class="line">-rwxr-xr-x    1 1000     1000           567 Nov 24  2022 cp_ta_to_tamproto.sh</div>
<div class="line">-rwxr-xr-x    1 1000     1000           156 Nov 24  2022 env.sh</div>
<div class="line">-rwxr-xr-x    1 1000     1000         98088 Nov 21  2022 eyrie-rt</div>
<div class="line">-rwxr-xr-x    1 1000     1000           290 Nov 24  2022 get-ip.sh</div>
<div class="line">-rwxr-xr-x    1 1000     1000        437656 Nov 24  2022 hello-app</div>
<div class="line">-rwxr-xr-x    1 1000     1000        153128 Nov 24  2022 hello-ta</div>
<div class="line">-rwxr-xr-x    1 1000     1000            65 Nov 24  2022 itc.sh</div>
<div class="line">-rwxr-xr-x    1 1000     1000           116 Nov 24  2022 rtc.sh</div>
<div class="line">-rwxr-xr-x    1 1000     1000           134 Nov 24  2022 showtamurl.sh</div>
<div class="line">-rwxr-xr-x    1 1000     1000        415280 Nov 24  2022 teep-agent-ta</div>
<div class="line">-rwxr-xr-x    1 1000     1000       2372112 Nov 24  2022 teep-broker-app</div>
<div class="line">#### ./hello-app hello-ta eyrie-rt</div>
<div class="line">[debug] UTM : 0xffffffff80000000-0xffffffff80100000 (1024 KB) (boot.c:127)</div>
<div class="line">[debug] DRAM: 0x179800000-0x179c00000 (4096 KB) (boot.c:128)</div>
<div class="line">[debug] FREE: 0x1799bd000-0x179c00000 (2316 KB), va 0xffffffff001bd000 (boot.c:133)</div>
<div class="line">[debug] eyrie boot finished. drop to the user land ... (boot.c:172)</div>
<div class="line">main start</div>
<div class="line">Hello TEEP from TEE!</div>
<div class="line">main end</div>
<div class="line">#### ./hello-app 8d82573a-926d-4754-9353-32dc29997f74.ta eyrie-rt</div>
<div class="line">[Keystone SDK] /home/user/keystone/sdk/src/host/ElfFile.cpp:26 : file does not exist - 8d82573a-926d-4754-9353-32dc29997f74.ta</div>
<div class="line">[Keystone SDK] /home/user/keystone/sdk/src/host/Enclave.cpp:209 : Invalid enclave ELF</div>
<div class="line"> </div>
<div class="line">./hello-app: Unable to start enclave</div>
<div class="line">#### ./teep-broker-app --tamurl http://tamproto_tam_api_1:8888/api/tam_cbor</div>
<div class="line">teep-broker.c compiled at Nov 24 2022 05:09:43</div>
<div class="line">uri = http://tamproto_tam_api_1:8888/api/tam_cbor, cose=0, talist=</div>
<div class="line">[debug] UTM : 0xffffffff80000000-0xffffffff80100000 (1024 KB) (boot.c:127)</div>
<div class="line">[debug] DRAM: 0x179800000-0x179c00000 (4096 KB) (boot.c:128)</div>
<div class="line">[debug] FREE: 0x1799f2000-0x179c00000 (2104 KB), va 0xffffffff001f2000 (boot.c:133)</div>
<div class="line">[debug] eyrie boot finished. drop to the user land ... (boot.c:172)</div>
<div class="line">[1970/01/01 00:00:08:4238] N: POST: http://tamproto_tam_api_1:8888/api/tam_cbor</div>
<div class="line">[1970/01/01 00:00:08:4285] N: (hexdump: zero length)</div>
<div class="line">[1970/01/01 00:00:08:4349] N: http://tamproto_tam_api_1:8888/api/tam_cbor</div>
<div class="line">[1970/01/01 00:00:08:5193] N: </div>
<div class="line">[1970/01/01 00:00:08:5203] N: 0000: 83 01 A5 01 81 01 03 81 00 04 43 01 02 05 14 48    ..........C....H</div>
<div class="line">[1970/01/01 00:00:08:5211] N: 0010: 77 77 77 77 77 77 77 77 15 81 00 02                wwwwwwww....    </div>
<div class="line">[1970/01/01 00:00:08:5217] N: </div>
<div class="line">[1970/01/01 00:00:08:5347] N: POST: http://tamproto_tam_api_1:8888/api/tam_cbor</div>
<div class="line">[1970/01/01 00:00:08:5354] N: </div>
<div class="line">[1970/01/01 00:00:08:5364] N: 0000: 82 02 A4 14 48 77 77 77 77 77 77 77 77 08 80 0E    ....Hwwwwwwww...</div>
<div class="line">[1970/01/01 00:00:08:5373] N: 0010: 80 0F 80                                           ...             </div>
<div class="line">[1970/01/01 00:00:08:5380] N: </div>
<div class="line">[1970/01/01 00:00:08:5427] N: http://tamproto_tam_api_1:8888/api/tam_cbor</div>
<div class="line">[1970/01/01 00:00:08:5735] N: </div>
<div class="line">[1970/01/01 00:00:08:5741] N: 0000: 82 03 A2 0A 81 59 01 66 D8 6B A2 02 58 73 82 58    .....Y.f.k..Xs.X</div>
<div class="line">[1970/01/01 00:00:08:5748] N: 0010: 24 82 2F 58 20 63 70 90 82 1C BB B2 67 95 42 78    $./X cp.....g.Bx</div>
<div class="line">[1970/01/01 00:00:08:5756] N: 0020: 7B 49 F4 5E 14 AF 0C BF AD 9E F4 A4 F0 B3 42 B9    {I.^..........B.</div>
<div class="line">[1970/01/01 00:00:08:5763] N: 0030: 23 35 56 05 AF 58 4A D2 84 43 A1 01 26 A0 F6 58    #5V..XJ..C..&amp;..X</div>
<div class="line">[1970/01/01 00:00:08:5770] N: 0040: 40 4C 09 82 3E 54 8D 4B 51 23 A7 68 34 2F 65 3F    @L..&gt;T.KQ#.h4/e?</div>
<div class="line">[1970/01/01 00:00:08:5778] N: 0050: CE 7E F1 8D 0A C0 24 19 2E AD D7 0C 67 6C 81 25    .~....$.....gl.%</div>
<div class="line">[1970/01/01 00:00:08:5785] N: 0060: FF A3 37 23 17 2C FB B7 67 73 45 88 70 13 DF A1    ..7#.,..gsE.p...</div>
<div class="line">[1970/01/01 00:00:08:5792] N: 0070: 1D 74 8C D3 14 03 B7 7C 84 40 46 D4 66 9E 37 44    .t.....|.@F.f.7D</div>
<div class="line">[1970/01/01 00:00:08:5801] N: 0080: FE 03 58 EA A5 01 01 02 01 03 58 86 A2 02 81 84    ..X.......X.....</div>
<div class="line">[1970/01/01 00:00:08:5808] N: 0090: 4B 54 45 45 50 2D 44 65 76 69 63 65 48 53 65 63    KTEEP-DeviceHSec</div>
<div class="line">[1970/01/01 00:00:08:5815] N: 00A0: 75 72 65 46 53 50 8D 82 57 3A 92 6D 47 54 93 53    ureFSP..W:.mGT.S</div>
<div class="line">[1970/01/01 00:00:08:5822] N: 00B0: 32 DC 29 99 7F 74 42 74 61 04 58 56 86 14 A4 01    2.)..tBta.XV....</div>
<div class="line">[1970/01/01 00:00:08:5829] N: 00C0: 50 FA 6B 4A 53 D5 AD 5F DF BE 9D E6 63 E4 D4 1F    P.kJS.._....c...</div>
<div class="line">[1970/01/01 00:00:08:5836] N: 00D0: FE 02 50 14 92 AF 14 25 69 5E 48 BF 42 9B 2D 51    ..P....%i^H.B.-Q</div>
<div class="line">[1970/01/01 00:00:08:5845] N: 00E0: F2 AB 45 03 58 24 82 2F 58 20 00 11 22 33 44 55    ..E.X$./X ..&quot;3DU</div>
<div class="line">[1970/01/01 00:00:08:5852] N: 00F0: 66 77 88 99 AA BB CC DD EE FF 01 23 45 67 89 AB    fw.........#Eg..</div>
<div class="line">[1970/01/01 00:00:08:5860] N: 0100: CD EF FE DC BA 98 76 54 32 10 0E 19 87 D0 01 0F    ......vT2.......</div>
<div class="line">[1970/01/01 00:00:08:5868] N: 0110: 02 0F 09 58 54 86 13 A1 15 78 4A 68 74 74 70 3A    ...XT....xJhttp:</div>
<div class="line">[1970/01/01 00:00:08:5876] N: 0120: 2F 2F 74 61 6D 70 72 6F 74 6F 5F 74 61 6D 5F 61    //tamproto_tam_a</div>
<div class="line">[1970/01/01 00:00:08:5885] N: 0130: 70 69 5F 31 3A 38 38 38 38 2F 54 41 73 2F 38 64    pi_1:8888/TAs/8d</div>
<div class="line">[1970/01/01 00:00:08:5893] N: 0140: 38 32 35 37 33 61 2D 39 32 36 64 2D 34 37 35 34    82573a-926d-4754</div>
<div class="line">[1970/01/01 00:00:08:5900] N: 0150: 2D 39 33 35 33 2D 33 32 64 63 32 39 39 39 37 66    -9353-32dc29997f</div>
<div class="line">[1970/01/01 00:00:08:5907] N: 0160: 37 34 2E 74 61 15 02 03 0F 0A 43 82 03 0F 14 48    74.ta.....C....H</div>
<div class="line">[1970/01/01 00:00:08:5914] N: 0170: AB A1 A2 A3 A4 A5 A6 A7                            ........        </div>
<div class="line">[1970/01/01 00:00:08:5923] N: </div>
<div class="line">TTRC:verifying signature of suit manifest</div>
<div class="line">TTRC:verify OK</div>
<div class="line">TTRC:command: 20</div>
<div class="line">TTRC:execute suit-set-parameters</div>
<div class="line">TTRC:command: 1</div>
<div class="line">TTRC:execute suit-condition-vendor-identifier</div>
<div class="line">TTRC:command: 2</div>
<div class="line">TTRC:execute suit-condition-class-identifier</div>
<div class="line">TTRC:command: 19</div>
<div class="line">TTRC:execute suit-set-parameters</div>
<div class="line">TTRC:command: 21</div>
<div class="line">TTRC:execute suit-directive-fetch</div>
<div class="line">TTRC:fetch_and_store component</div>
<div class="line">[1970/01/01 00:00:09:3454] N: GET: http://tamproto_tam_api_1:8888/TAs/8d82573a-926d-4754-9353-32dc29997f74.ta</div>
<div class="line">[1970/01/01 00:00:09:3475] N: http://tamproto_tam_api_1:8888/TAs/8d82573a-926d-4754-9353-32dc29997f74.ta</div>
<div class="line">TTRC:component download 153128</div>
<div class="line">TTRC:ta-store.c: store_component() store component</div>
<div class="line">TTRC:  device   = TEEP-Device</div>
<div class="line">TTRC:  storage  = SecureFS</div>
<div class="line">TTRC:  filename = 8d82573a-926d-4754-9353-32dc29997f74.ta</div>
<div class="line">TTRC:  image_len = 153128</div>
<div class="line">TTRC:finish fetch</div>
<div class="line">TTRC:command: 3</div>
<div class="line">TTRC:execute suit-condition-image-match</div>
<div class="line">TTRC:end of command seq</div>
<div class="line">[1970/01/01 00:00:09:9560] N: POST: http://tamproto_tam_api_1:8888/api/tam_cbor</div>
<div class="line">[1970/01/01 00:00:09:9565] N: </div>
<div class="line">[1970/01/01 00:00:09:9569] N: 0000: 82 05 A1 14 48 77 77 77 77 77 77 77 77             ....Hwwwwwwww   </div>
<div class="line">[1970/01/01 00:00:09:9574] N: </div>
<div class="line">[1970/01/01 00:00:09:9583] N: http://tamproto_tam_api_1:8888/api/tam_cbor</div>
<div class="line">[1970/01/01 00:00:09:9754] N: (hexdump: zero length)</div>
<div class="line">#### ls -l</div>
<div class="line">total 3573</div>
<div class="line">-rw-------    1 root     root        153128 Jan  1 00:00 8d82573a-926d-4754-9353-32dc29997f74.ta</div>
<div class="line">-rwxr-xr-x    1 1000     1000           567 Nov 24  2022 cp_ta_to_tamproto.sh</div>
<div class="line">-rwxr-xr-x    1 1000     1000           156 Nov 24  2022 env.sh</div>
<div class="line">-rwxr-xr-x    1 1000     1000         98088 Nov 21  2022 eyrie-rt</div>
<div class="line">-rwxr-xr-x    1 1000     1000           290 Nov 24  2022 get-ip.sh</div>
<div class="line">-rwxr-xr-x    1 1000     1000        437656 Nov 24  2022 hello-app</div>
<div class="line">-rwxr-xr-x    1 1000     1000        153128 Nov 24  2022 hello-ta</div>
<div class="line">-rwxr-xr-x    1 1000     1000            65 Nov 24  2022 itc.sh</div>
<div class="line">-rwxr-xr-x    1 1000     1000           116 Nov 24  2022 rtc.sh</div>
<div class="line">-rwxr-xr-x    1 1000     1000           134 Nov 24  2022 showtamurl.sh</div>
<div class="line">-rwxr-xr-x    1 1000     1000        415280 Nov 24  2022 teep-agent-ta</div>
<div class="line">-rwxr-xr-x    1 1000     1000       2372112 Nov 24  2022 teep-broker-app</div>
<div class="line">#### ./hello-app 8d82573a-926d-4754-9353-32dc29997f74.ta eyrie-rt</div>
<div class="line">[debug] UTM : 0xffffffff80000000-0xffffffff80100000 (1024 KB) (boot.c:127)</div>
<div class="line">[debug] DRAM: 0x179800000-0x179c00000 (4096 KB) (boot.c:128)</div>
<div class="line">[debug] FREE: 0x1799bd000-0x179c00000 (2316 KB), va 0xffffffff001bd000 (boot.c:133)</div>
<div class="line">[debug] eyrie boot finished. drop to the user land ... (boot.c:172)</div>
<div class="line">main start</div>
<div class="line">Hello TEEP from TEE!</div>
<div class="line">main end</div>
<div class="line">####  done</div>
</div><!-- fragment --><p >Cleaning built binaries. Deleting the built binaries are required when starting to build TEEP-Device on other CPU architectures otherwise will generate errors.</p>
<div class="fragment"><div class="line">$ make clean</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md27"></a>
Build TEEP-Device for OP-TEE with Docker</h2>
<p ><b>Clone TEEP-Device</b></p>
<div class="fragment"><div class="line"># Clone the teep-device repo and checkout master branch</div>
<div class="line">$ git clone https://github.com/mcd500/teep-device.git</div>
<div class="line">$ cd teep-device</div>
<div class="line">$ git checkout master</div>
<div class="line"> </div>
<div class="line"># Sync and update the submodules</div>
<div class="line">$ git submodule sync --recursive</div>
<div class="line">$ git submodule update --init --recursive</div>
</div><!-- fragment --><p ><b>Start the Docker</b></p>
<div class="fragment"><div class="line"># Start the Docker</div>
<div class="line">$ docker run --network tamproto_default -w /home/user/teep-device -it --rm -v $(pwd):/home/user/teep-device aistcpsec/taref-dev:optee</div>
</div><!-- fragment --><p >After you start the Docker command, you will be logged-in inside the Docker container. Following are the commands to be executed inside the Docker.</p>
<div class="fragment"><div class="line"># [Inside docker image]</div>
<div class="line"> </div>
<div class="line"># Change to teep-device</div>
<div class="line">$ cd ~/teep-device/</div>
<div class="line"> </div>
<div class="line"># Build the teep device</div>
<div class="line">$ make</div>
</div><!-- fragment --><p >After the successful build, run the sample TEEP session with tamproto.</p>
<div class="fragment"><div class="line"># After the successful build</div>
<div class="line"># Run the TEEP-Device</div>
<div class="line">$ make run-sample-session</div>
</div><!-- fragment --><p >Trimmed output of the TEEP-Device</p>
<div class="fragment"><div class="line">...</div>
<div class="line">...</div>
<div class="line">...</div>
<div class="line">FI stub: Booting Linux Kernel...</div>
<div class="line">EFI stub: EFI_RNG_PROTOCOL unavailable, no randomness supplied</div>
<div class="line">EFI stub: Using DTB from configuration table</div>
<div class="line">EFI stub: Exiting boot services and installing virtual address map...</div>
<div class="line">Starting syslogd: OK</div>
<div class="line">Starting klogd: OK</div>
<div class="line">Initializing random number generator... [    3.248115] random: dd: uninitialized urandom read (512 bytes read)</div>
<div class="line">done.</div>
<div class="line">Set permissions on /dev/tee*: OK</div>
<div class="line">Set permissions on /dev/ion: OK</div>
<div class="line">Create/set permissions on /data/tee: OK</div>
<div class="line">Starting tee-supplicant: OK</div>
<div class="line">Starting network: OK</div>
<div class="line">Starting network (udhcpc): OK</div>
<div class="line"> </div>
<div class="line">Welcome to Buildroot, type root or test to login</div>
<div class="line">buildroot login: root</div>
<div class="line">#  done, guest is booted.</div>
<div class="line"> </div>
<div class="line">export LD_LIBRARY_PATH=/lib:/lib/arm-linux-gnueabihf:/lib/optee_armtz:/usr/lib</div>
<div class="line"># cd teep-broker</div>
<div class="line"># ls -l</div>
<div class="line">total 4224</div>
<div class="line">-rwxr-xr-x    1 root     root           567 Nov 24 06:51 cp_ta_to_tamproto.sh</div>
<div class="line">-rwxr-xr-x    1 root     root           153 Nov 24 06:51 env.sh</div>
<div class="line">-rwxr-xr-x    1 root     root           290 Nov 24 06:51 get-ip.sh</div>
<div class="line">-rwxr-xr-x    1 root     root         14112 Nov 24 06:51 hello-app</div>
<div class="line">-rwxr-xr-x    1 root     root            65 Nov 24 06:51 itc.sh</div>
<div class="line">-rwxr-xr-x    1 root     root           116 Nov 24 06:51 rtc.sh</div>
<div class="line">-rwxr-xr-x    1 root     root           134 Nov 24 06:51 showtamurl.sh</div>
<div class="line">-rwxr-xr-x    1 root     root       4280472 Nov 24 06:51 teep-broker-app</div>
<div class="line"># ./hello-app</div>
<div class="line">hello-app: TEEC_Opensession failed with code 0xffff0008 origin 0x3</div>
<div class="line"># ./teep-broker-app --tamurl http://tamproto_tam_api_1:8888/api/tam_cbor</div>
<div class="line">teep-broker.c compiled at Nov 24 2022 06:51:18</div>
<div class="line">uri = http://tamproto_tam_api_1:8888/api/tam_cbor, cose=0, talist=</div>
<div class="line">[2022/11/24 06:52:30:1216] N: POST: http://tamproto_tam_api_1:8888/api/tam_cbor</div>
<div class="line">[2022/11/24 06:52:30:1226] N: (hexdump: zero length)</div>
<div class="line">[2022/11/24 06:52:30:1270] N: http://tamproto_tam_api_1:8888/api/tam_cbor</div>
<div class="line">[2022/11/24 06:52:30:1915] N: </div>
<div class="line">[2022/11/24 06:52:30:1923] N: 0000: 83 01 A5 01 81 01 03 81 00 04 43 01 02 05 14 48    ..........C....H</div>
<div class="line">[2022/11/24 06:52:30:1929] N: 0010: 77 77 77 77 77 77 77 77 15 81 00 02                wwwwwwww....    </div>
<div class="line">[2022/11/24 06:52:30:1932] N: </div>
<div class="line">[2022/11/24 06:52:30:2009] N: POST: http://tamproto_tam_api_1:8888/api/tam_cbor</div>
<div class="line">[2022/11/24 06:52:30:2013] N: </div>
<div class="line">[2022/11/24 06:52:30:2016] N: 0000: 82 02 A4 14 48 77 77 77 77 77 77 77 77 08 80 0E    ....Hwwwwwwww...</div>
<div class="line">[2022/11/24 06:52:30:2020] N: 0010: 80 0F 80                                           ...             </div>
<div class="line">[2022/11/24 06:52:30:2023] N: </div>
<div class="line">[2022/11/24 06:52:30:2033] N: http://tamproto_tam_api_1:8888/api/tam_cbor</div>
<div class="line">[2022/11/24 06:52:30:2215] N: </div>
<div class="line">[2022/11/24 06:52:30:2217] N: 0000: 82 03 A2 0A 81 59 01 66 D8 6B A2 02 58 73 82 58    .....Y.f.k..Xs.X</div>
<div class="line">[2022/11/24 06:52:30:2222] N: 0010: 24 82 2F 58 20 63 70 90 82 1C BB B2 67 95 42 78    $./X cp.....g.Bx</div>
<div class="line">[2022/11/24 06:52:30:2226] N: 0020: 7B 49 F4 5E 14 AF 0C BF AD 9E F4 A4 F0 B3 42 B9    {I.^..........B.</div>
<div class="line">[2022/11/24 06:52:30:2229] N: 0030: 23 35 56 05 AF 58 4A D2 84 43 A1 01 26 A0 F6 58    #5V..XJ..C..&amp;..X</div>
<div class="line">[2022/11/24 06:52:30:2233] N: 0040: 40 91 2A 3A BF 8A 24 6E 5A A1 A7 69 D6 8F 12 DB    @.*:..$nZ..i....</div>
<div class="line">[2022/11/24 06:52:30:2236] N: 0050: 8F D1 FF F3 11 9F 02 58 C0 A4 B2 8F FF D0 6C A9    .......X......l.</div>
<div class="line">[2022/11/24 06:52:30:2242] N: 0060: 96 75 B1 43 37 B1 8C B9 73 58 15 05 5E F4 39 3A    .u.C7...sX..^.9:</div>
<div class="line">[2022/11/24 06:52:30:2246] N: 0070: 88 D7 DC B2 06 5D 58 F4 8C 70 78 D1 70 C3 1B 7B    .....]X..px.p..{</div>
<div class="line">[2022/11/24 06:52:30:2250] N: 0080: 4F 03 58 EA A5 01 01 02 01 03 58 86 A2 02 81 84    O.X.......X.....</div>
<div class="line">[2022/11/24 06:52:30:2253] N: 0090: 4B 54 45 45 50 2D 44 65 76 69 63 65 48 53 65 63    KTEEP-DeviceHSec</div>
<div class="line">[2022/11/24 06:52:30:2257] N: 00A0: 75 72 65 46 53 50 8D 82 57 3A 92 6D 47 54 93 53    ureFSP..W:.mGT.S</div>
<div class="line">[2022/11/24 06:52:30:2261] N: 00B0: 32 DC 29 99 7F 74 42 74 61 04 58 56 86 14 A4 01    2.)..tBta.XV....</div>
<div class="line">[2022/11/24 06:52:30:2264] N: 00C0: 50 FA 6B 4A 53 D5 AD 5F DF BE 9D E6 63 E4 D4 1F    P.kJS.._....c...</div>
<div class="line">[2022/11/24 06:52:30:2268] N: 00D0: FE 02 50 14 92 AF 14 25 69 5E 48 BF 42 9B 2D 51    ..P....%i^H.B.-Q</div>
<div class="line">[2022/11/24 06:52:30:2271] N: 00E0: F2 AB 45 03 58 24 82 2F 58 20 00 11 22 33 44 55    ..E.X$./X ..3DU</div>
<div class="line">[2022/11/24 06:52:30:2274] N: 00F0: 66 77 88 99 AA BB CC DD EE FF 01 23 45 67 89 AB    fw.........#Eg..</div>
<div class="line">[2022/11/24 06:52:30:2278] N: 0100: CD EF FE DC BA 98 76 54 32 10 0E 19 87 D0 01 0F    ......vT2.......</div>
<div class="line">[2022/11/24 06:52:30:2285] N: 0110: 02 0F 09 58 54 86 13 A1 15 78 4A 68 74 74 70 3A    ...XT....xJhttp:</div>
<div class="line">[2022/11/24 06:52:30:2289] N: 0120: 2F 2F 74 61 6D 70 72 6F 74 6F 5F 74 61 6D 5F 61    //tamproto_tam_a</div>
<div class="line">[2022/11/24 06:52:30:2292] N: 0130: 70 69 5F 31 3A 38 38 38 38 2F 54 41 73 2F 38 64    pi_1:8888/TAs/8d</div>
<div class="line">[2022/11/24 06:52:30:2297] N: 0140: 38 32 35 37 33 61 2D 39 32 36 64 2D 34 37 35 34    82573a-926d-4754</div>
<div class="line">[2022/11/24 06:52:30:2301] N: 0150: 2D 39 33 35 33 2D 33 32 64 63 32 39 39 39 37 66    -9353-32dc29997f</div>
<div class="line">[2022/11/24 06:52:30:2305] N: 0160: 37 34 2E 74 61 15 02 03 0F 0A 43 82 03 0F 14 48    74.ta.....C....H</div>
<div class="line">[2022/11/24 06:52:30:2309] N: 0170: AB A1 A2 A3 A4 A5 A6 A7                            ........        </div>
<div class="line">[2022/11/24 06:52:30:2312] N: </div>
<div class="line">[2022/11/24 06:52:30:5524] N: GET: http://tamproto_tam_api_1:8888/TAs/8d82573a-926d-4754-9353-32dc29997f74.ta</div>
<div class="line">[2022/11/24 06:52:30:5539] N: http://tamproto_tam_api_1:8888/TAs/8d82573a-926d-4754-9353-32dc29997f74.ta</div>
<div class="line">[2022/11/24 06:52:30:6340] N: POST: http://tamproto_tam_api_1:8888/api/tam_cbor</div>
<div class="line">[2022/11/24 06:52:30:6344] N: </div>
<div class="line">[2022/11/24 06:52:30:6348] N: 0000: 82 05 A1 14 48 77 77 77 77 77 77 77 77             ....Hwwwwwwww   </div>
<div class="line">[2022/11/24 06:52:30:6352] N: </div>
<div class="line">[2022/11/24 06:52:30:6359] N: http://tamproto_tam_api_1:8888/api/tam_cbor</div>
<div class="line">[2022/11/24 06:52:30:6513] N: (hexdump: zero length)</div>
<div class="line"># ls -l</div>
<div class="line">total 4224</div>
<div class="line">-rwxr-xr-x    1 root     root           567 Nov 24 06:51 cp_ta_to_tamproto.sh</div>
<div class="line">-rwxr-xr-x    1 root     root           153 Nov 24 06:51 env.sh</div>
<div class="line">-rwxr-xr-x    1 root     root           290 Nov 24 06:51 get-ip.sh</div>
<div class="line">-rwxr-xr-x    1 root     root         14112 Nov 24 06:51 hello-app</div>
<div class="line">-rwxr-xr-x    1 root     root            65 Nov 24 06:51 itc.sh</div>
<div class="line">-rwxr-xr-x    1 root     root           116 Nov 24 06:51 rtc.sh</div>
<div class="line">-rwxr-xr-x    1 root     root           134 Nov 24 06:51 showtamurl.sh</div>
<div class="line">-rwxr-xr-x    1 root     root       4280472 Nov 24 06:51 teep-broker-app</div>
<div class="line"># ./hello-app</div>
<div class="line">#  done</div>
<div class="line"> </div>
<div class="line">cat /home/user/optee/out/bin/serial1.log</div>
<div class="line"> </div>
<div class="line">...</div>
<div class="line">...</div>
<div class="line">I/TC: Switching console to device: /pl011@9040000</div>
<div class="line">I/TC: OP-TEE version: 3.10.0-dev (gcc version 8.3.0</div>
<div class="line"> (GNU Toolchain for the A-profile Architecture 8.3-2019.03 (arm-rel-8.36))) #1 Mon 21 Nov 2022 11:59:41 AM UTC aarch64</div>
<div class="line">I/TC: Primary CPU initializing</div>
<div class="line">D/TC:0 0 paged_init_primary:1188 Executing at offset 0xc6842000 with virtual load address 0xd4942000</div>
<div class="line">D/TC:0 0 call_initcalls:21 level 1 register_time_source()</div>
<div class="line">D/TC:0 0 call_initcalls:21 level 1 teecore_init_pub_ram()</div>
<div class="line">D/TC:0 0 call_initcalls:21 level 3 check_ta_store()</div>
<div class="line">D/TC:0 0 check_ta_store:636 TA store: &quot;Secure Storage TA&quot;</div>
<div class="line">D/TC:0 0 check_ta_store:636 TA store: &quot;REE&quot;</div>
<div class="line">D/TC:0 0 call_initcalls:21 level 3 init_user_ta()</div>
<div class="line">D/TC:0 0 call_initcalls:21 level 3 verify_pseudo_tas_conformance()</div>
<div class="line">D/TC:0 0 call_initcalls:21 level 3 mobj_mapped_shm_init()</div>
<div class="line">D/TC:0 0 mobj_mapped_shm_init:434 Shared memory address range: d6400000, d8400000</div>
<div class="line">D/TC:0 0 call_initcalls:21 level 3 tee_cryp_init()</div>
<div class="line">D/TC:0 0 call_initcalls:21 level 4 tee_fs_init_key_manager()</div>
<div class="line">D/TC:0 0 call_initcalls:21 level 6 mobj_init()</div>
<div class="line">D/TC:0 0 call_initcalls:21 level 6 default_mobj_init()</div>
<div class="line">D/TC:0 0 call_finalcalls:40 level 1 release_external_dt()</div>
<div class="line">I/TC: Primary CPU switching to normal world boot</div>
<div class="line">I/TC: Secondary CPU 1 initializing</div>
<div class="line">D/TC:1   select_vector:1118 SMCCC_ARCH_WORKAROUND_1 (0x80008000) available</div>
<div class="line">D/TC:1   select_vector:1119 SMC Workaround for CVE-2017-5715 used</div>
<div class="line">I/TC: Secondary CPU 1 switching to normal world boot</div>
<div class="line">D/TC:1   tee_entry_exchange_capabilities:102 Dynamic shared memory is enabled</div>
<div class="line">D/TC:1 0 core_mmu_entry_to_finer_grained:762 xlat tables used 7 / 7</div>
<div class="line">D/TC:? 0 tee_ta_init_pseudo_ta_session:283 Lookup pseudo TA 7011a688-ddde-4053-a5a9-7b3c4ddf13b8</div>
<div class="line">D/TC:? 0 tee_ta_init_pseudo_ta_session:296 Open device.pta</div>
<div class="line">D/TC:? 0 tee_ta_init_pseudo_ta_session:310 device.pta : 7011a688-ddde-4053-a5a9-7b3c4ddf13b8</div>
<div class="line">D/TC:? 0 tee_ta_close_session:499 csess 0xd49bea00 id 1</div>
<div class="line">D/TC:? 0 tee_ta_close_session:518 Destroy session</div>
<div class="line">D/TC:? 0 tee_ta_init_pseudo_ta_session:283 Lookup pseudo TA 8d82573a-926d-4754-9353-32dc29997f74</div>
<div class="line">D/TC:? 0 load_ldelf:704 ldelf load address 0x40006000</div>
<div class="line">D/LD:  ldelf:134 Loading TA 8d82573a-926d-4754-9353-32dc29997f74</div>
<div class="line">D/TC:? 0 tee_ta_init_pseudo_ta_session:283 Lookup pseudo TA 3a2f8978-5dc0-11e8-9c2d-fa7ae01bbebc</div>
<div class="line">D/TC:? 0 tee_ta_init_pseudo_ta_session:296 Open system.pta</div>
<div class="line">D/TC:? 0 tee_ta_init_pseudo_ta_session:310 system.pta : 3a2f8978-5dc0-11e8-9c2d-fa7ae01bbebc</div>
<div class="line">D/TC:? 0 system_open_ta_binary:257 Lookup user TA ELF 8d82573a-926d-4754-9353-32dc29997f74 (Secure Storage TA)</div>
<div class="line">D/TC:? 0 system_open_ta_binary:260 res=0xffff0008</div>
<div class="line">D/TC:? 0 system_open_ta_binary:257 Lookup user TA ELF 8d82573a-926d-4754-9353-32dc29997f74 (REE)</div>
<div class="line">D/TC:? 0 system_open_ta_binary:260 res=0xffff0008</div>
<div class="line">D/TC:? 0 tee_ta_invoke_command:773 Error: ffff0008 of 4</div>
<div class="line">E/LD:  init_elf:438 sys_open_ta_bin(8d82573a-926d-4754-9353-32dc29997f74)</div>
<div class="line">E/TC:? 0 init_with_ldelf:232 ldelf failed with res: 0xffff0008</div>
<div class="line">D/TC:? 0 tee_ta_close_session:499 csess 0xd49be860 id 1</div>
<div class="line">D/TC:? 0 tee_ta_close_session:518 Destroy session</div>
<div class="line">D/TC:? 0 destroy_context:298 Destroy TA ctx (0xd49be800)</div>
<div class="line">D/TC:? 0 tee_ta_close_session:499 csess 0xd49be060 id 1</div>
<div class="line">D/TC:? 0 tee_ta_close_session:518 Destroy session</div>
<div class="line">E/TC:? 0 tee_ta_open_session:728 Failed. Return error 0xffff0008</div>
<div class="line">D/TC:? 0 tee_ta_init_pseudo_ta_session:283 Lookup pseudo TA 68373894-5bb3-403c-9eec-3114a1f5d3fc</div>
<div class="line">D/TC:? 0 load_ldelf:704 ldelf load address 0x40006000</div>
<div class="line">D/LD:  ldelf:134 Loading TA 68373894-5bb3-403c-9eec-3114a1f5d3fc</div>
<div class="line">D/TC:? 0 tee_ta_init_session_with_context:573 Re-open TA 3a2f8978-5dc0-11e8-9c2d-fa7ae01bbebc</div>
<div class="line">D/TC:? 0 system_open_ta_binary:257 Lookup user TA ELF 68373894-5bb3-403c-9eec-3114a1f5d3fc (Secure Storage TA)</div>
<div class="line">D/TC:? 0 system_open_ta_binary:260 res=0xffff0008</div>
<div class="line">D/TC:? 0 system_open_ta_binary:257 Lookup user TA ELF 68373894-5bb3-403c-9eec-3114a1f5d3fc (REE)</div>
<div class="line">D/TC:? 0 system_open_ta_binary:260 res=0x0</div>
<div class="line">D/LD:  ldelf:169 ELF (68373894-5bb3-403c-9eec-3114a1f5d3fc) at 0x4007c000</div>
<div class="line">D/TC:? 0 tee_ta_close_session:499 csess 0xd49bd340 id 1</div>
<div class="line">D/TC:? 0 tee_ta_close_session:518 Destroy session</div>
<div class="line">M/TA: TTRC:verifying signature of suit manifest</div>
<div class="line">M/TA: TTRC:verify OK</div>
<div class="line">M/TA: TTRC:command: 20</div>
<div class="line">M/TA: TTRC:execute suit-set-parameters</div>
<div class="line">M/TA: TTRC:command: 1</div>
<div class="line">M/TA: TTRC:execute suit-condition-vendor-identifier</div>
<div class="line">M/TA: TTRC:command: 2</div>
<div class="line">M/TA: TTRC:execute suit-condition-class-identifier</div>
<div class="line">M/TA: TTRC:command: 19</div>
<div class="line">M/TA: TTRC:execute suit-set-parameters</div>
<div class="line">M/TA: TTRC:command: 21</div>
<div class="line">M/TA: TTRC:execute suit-directive-fetch</div>
<div class="line">M/TA: TTRC:fetch_and_store component</div>
<div class="line">M/TA: TTRC:component download 55976</div>
<div class="line">M/TA: TTRC:ta-store.c: store_component() store component</div>
<div class="line">M/TA: TTRC:  device   = TEEP-Device</div>
<div class="line">M/TA: TTRC:  storage  = SecureFS</div>
<div class="line">M/TA: TTRC:  filename = 8d82573a-926d-4754-9353-32dc29997f74.ta</div>
<div class="line">M/TA: TTRC:  image_len = 55976</div>
<div class="line">D/TC:? 0 tee_ta_init_pseudo_ta_session:283 Lookup pseudo TA 6e256cba-fc4d-4941-ad09-2ca1860342dd</div>
<div class="line">D/TC:? 0 tee_ta_init_pseudo_ta_session:296 Open secstor_ta_mgmt</div>
<div class="line">D/TC:? 0 tee_ta_init_pseudo_ta_session:310 secstor_ta_mgmt : 6e256cba-fc4d-4941-ad09-2ca1860342dd</div>
<div class="line">D/TC:? 0 install_ta:99 Installing 8d82573a-926d-4754-9353-32dc29997f74</div>
<div class="line">D/TC:? 0 tee_ta_close_session:499 csess 0xd49bbfa0 id 1</div>
<div class="line">D/TC:? 0 tee_ta_close_session:518 Destroy session</div>
<div class="line">M/TA: TTRC:finish fetch</div>
<div class="line">M/TA: TTRC:command: 3</div>
<div class="line">M/TA: TTRC:execute suit-condition-image-match</div>
<div class="line">M/TA: TTRC:end of command seq</div>
<div class="line">D/TC:? 0 tee_ta_close_session:499 csess 0xd49bdb40 id 1</div>
<div class="line">D/TC:? 0 tee_ta_close_session:518 Destroy session</div>
<div class="line">D/TC:? 0 destroy_context:298 Destroy TA ctx (0xd49bdae0)</div>
<div class="line">D/TC:? 0 tee_ta_init_pseudo_ta_session:283 Lookup pseudo TA 8d82573a-926d-4754-9353-32dc29997f74</div>
<div class="line">D/TC:? 0 load_ldelf:704 ldelf load address 0x40006000</div>
<div class="line">D/LD:  ldelf:134 Loading TA 8d82573a-926d-4754-9353-32dc29997f74</div>
<div class="line">D/TC:? 0 tee_ta_init_session_with_context:573 Re-open TA 3a2f8978-5dc0-11e8-9c2d-fa7ae01bbebc</div>
<div class="line">D/TC:? 0 system_open_ta_binary:257 Lookup user TA ELF 8d82573a-926d-4754-9353-32dc29997f74 (Secure Storage TA)</div>
<div class="line">D/TC:? 0 system_open_ta_binary:260 res=0x0</div>
<div class="line">D/LD:  ldelf:169 ELF (8d82573a-926d-4754-9353-32dc29997f74) at 0x4003a000</div>
<div class="line">D/TC:? 0 tee_ta_close_session:499 csess 0xd49bb600 id 1</div>
<div class="line">D/TC:? 0 tee_ta_close_session:518 Destroy session</div>
<div class="line">Hello TEEP from TEE!</div>
<div class="line">D/TC:? 0 tee_ta_close_session:499 csess 0xd49bbe00 id 1</div>
<div class="line">D/TC:? 0 tee_ta_close_session:518 Destroy session</div>
<div class="line">D/TC:? 0 destroy_context:298 Destroy TA ctx (0xd49bbda0)</div>
<div class="line">! fgrep &#39;ERR:&#39; /home/user/optee/out/bin/serial1.log</div>
<div class="line">fgrep &#39;Hello TEEP from TEE!&#39; /home/user/optee/out/bin/serial1.log</div>
<div class="line">Hello TEEP from TEE!</div>
<div class="line">make[1]: Leaving directory &#39;/home/user/teep-device/sample&#39;</div>
<div class="line">build-user@1364029c42f3:~/teep-device$ </div>
</div><!-- fragment --><p >Cleaning built binaries. Deleting the built binaries are required when starting to build TEEP-Device on other CPU architectures otherwise will generate errors.</p>
<div class="fragment"><div class="line">$ make clean</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md28"></a>
Build TEEP-Device for SGX with Docker</h2>
<p ><b>Clone TEEP-Device</b></p>
<div class="fragment"><div class="line"># Clone the teep-device repo and checkout master branch</div>
<div class="line">$ git clone https://github.com/mcd500/teep-device.git</div>
<div class="line">$ cd teep-device</div>
<div class="line">$ git checkout master</div>
<div class="line"> </div>
<div class="line"># Sync and update the submodules</div>
<div class="line">$ git submodule sync --recursive</div>
<div class="line">$ git submodule update --init --recursive</div>
</div><!-- fragment --><p ><b>Start the Docker</b></p>
<div class="fragment"><div class="line"># Start the Docker</div>
<div class="line">$ docker run --network tamproto_default -w /home/user/teep-device -it --rm -v $(pwd):/home/user/teep-device aistcpsec/taref-dev:sgx</div>
</div><!-- fragment --><p >After you start the Docker command, you will be logged-in inside the Docker container. Following are the commands to be executed inside the Docker</p>
<div class="fragment"><div class="line"># [Inside docker image]</div>
<div class="line"> </div>
<div class="line"># Change to teep-device</div>
<div class="line">$ cd ~/teep-device/</div>
<div class="line"> </div>
<div class="line"># set the TEE environments for SGX</div>
<div class="line"># The MACHINE=SIM specifies running SGX in simulation mode which</div>
<div class="line"># will allow running SGX on all Intel and AMD cpu regardless of SGX support.</div>
<div class="line">$ export MACHINE=SIM</div>
<div class="line"> </div>
<div class="line"># Build the teep device</div>
<div class="line">$ make</div>
</div><!-- fragment --><p >After the successful build, run the sample TEEP session with tamproto.</p>
<div class="fragment"><div class="line"># After the successful build</div>
<div class="line"># Run the TEEP-Device</div>
<div class="line">$ make run-sample-session</div>
</div><!-- fragment --><p >Trimmed output of the run.</p>
<div class="fragment"><div class="line">build-user@4fcbd11fb97c:~/teep-device$ make run-sample-session</div>
<div class="line">make -C sample run-session TAM_URL=http://tamproto_tam_api_1:8888</div>
<div class="line">make[1]: Entering directory &#39;/home/user/teep-device/sample&#39;</div>
<div class="line">make -C /home/user/teep-device/sample/../hello-tc/build-sgx </div>
<div class="line">SOURCE=/home/user/teep-device/sample/../hello-tc upload-download-manifest</div>
<div class="line">make[2]: Entering directory &#39;/home/user/teep-device/hello-tc/build-sgx&#39;</div>
<div class="line">curl http://tamproto_tam_api_1:8888/panel/upload \</div>
<div class="line">    -F &quot;file=@/home/user/teep-device/hello-tc/build-sgx/signed-download-tc.suit;</div>
<div class="line">    filename=integrated-payload-manifest.cbor&quot;</div>
<div class="line">&lt;!-- /*</div>
<div class="line"> </div>
<div class="line">...</div>
<div class="line">...</div>
<div class="line">...</div>
<div class="line">[__create_enclave /home/user/linux-sgx/psw/urts/urts_com.h:332] add tcs 0x7f62b7fe9000</div>
<div class="line">[__create_enclave /home/user/linux-sgx/psw/urts/urts_com.h:332] add tcs 0x7f62b841d000</div>
<div class="line">[__create_enclave /home/user/linux-sgx/psw/urts/urts_com.h:332] add tcs 0x7f62b8851000</div>
<div class="line">[__create_enclave /home/user/linux-sgx/psw/urts/urts_com.h:332] add tcs 0x7f62b8c85000</div>
<div class="line">[__create_enclave /home/user/linux-sgx/psw/urts/urts_com.h:332] add tcs 0x7f62b90b9000</div>
<div class="line">[__create_enclave /home/user/linux-sgx/psw/urts/urts_com.h:332] add tcs 0x7f62b94ed000</div>
<div class="line">[__create_enclave /home/user/linux-sgx/psw/urts/urts_com.h:342] Debug enclave. Checking if VTune is profiling or SGX_DBG_OPTIN is set</div>
<div class="line">[read_cpusvn_file ../cpusvn_util.cpp:96] Couldn&#39;t find/open the configuration file /home/user/.cpusvn.conf.</div>
<div class="line">[2022/11/24 07:06:03:9250] N: POST: http://tamproto_tam_api_1:8888/api/tam_cbor</div>
<div class="line">[2022/11/24 07:06:03:9250] N: (hexdump: zero length)</div>
<div class="line">[2022/11/24 07:06:03:9250] N: http://tamproto_tam_api_1:8888/api/tam_cbor</div>
<div class="line">[2022/11/24 07:06:03:9329] N: </div>
<div class="line">[2022/11/24 07:06:03:9329] N: 0000: 83 01 A5 01 81 01 03 81 00 04 43 01 02 05 14 48    ..........C....H</div>
<div class="line">[2022/11/24 07:06:03:9329] N: 0010: 77 77 77 77 77 77 77 77 15 81 00 02                wwwwwwww....    </div>
<div class="line">[2022/11/24 07:06:03:9330] N: </div>
<div class="line">[2022/11/24 07:06:03:9330] N: POST: http://tamproto_tam_api_1:8888/api/tam_cbor</div>
<div class="line">[2022/11/24 07:06:03:9330] N: </div>
<div class="line">[2022/11/24 07:06:03:9330] N: 0000: 82 02 A4 14 48 77 77 77 77 77 77 77 77 08 80 0E    ....Hwwwwwwww...</div>
<div class="line">[2022/11/24 07:06:03:9330] N: 0010: 80 0F 80                                           ...             </div>
<div class="line">[2022/11/24 07:06:03:9330] N: </div>
<div class="line">[2022/11/24 07:06:03:9331] N: http://tamproto_tam_api_1:8888/api/tam_cbor</div>
<div class="line">[2022/11/24 07:06:03:9393] N: </div>
<div class="line">[2022/11/24 07:06:03:9393] N: 0000: 82 03 A2 0A 81 59 01 66 D8 6B A2 02 58 73 82 58    .....Y.f.k..Xs.X</div>
<div class="line">[2022/11/24 07:06:03:9393] N: 0010: 24 82 2F 58 20 63 70 90 82 1C BB B2 67 95 42 78    $./X cp.....g.Bx</div>
<div class="line">[2022/11/24 07:06:03:9393] N: 0020: 7B 49 F4 5E 14 AF 0C BF AD 9E F4 A4 F0 B3 42 B9    {I.^..........B.</div>
<div class="line">[2022/11/24 07:06:03:9393] N: 0030: 23 35 56 05 AF 58 4A D2 84 43 A1 01 26 A0 F6 58    #5V..XJ..C..&amp;..X</div>
<div class="line">[2022/11/24 07:06:03:9393] N: 0040: 40 12 4A E1 1D DB DA 8A F7 FE 39 D2 57 D3 27 FF    @.J.......9.W.&#39;.</div>
<div class="line">[2022/11/24 07:06:03:9393] N: 0050: 28 E6 F3 EF D9 E2 7A AD A9 70 B8 50 A3 EA 43 3C    (.....z..p.P..C&lt;</div>
<div class="line">[2022/11/24 07:06:03:9393] N: 0060: 94 DC B3 58 6D E9 B0 21 EF 50 4B F7 02 81 A4 AF    ...Xm..!.PK.....</div>
<div class="line">[2022/11/24 07:06:03:9393] N: 0070: 7D DF 7E E6 57 2A F0 07 0A 89 3D E4 B7 BA 99 5F    }.~.W*....=...._</div>
<div class="line">[2022/11/24 07:06:03:9393] N: 0080: E3 03 58 EA A5 01 01 02 01 03 58 86 A2 02 81 84    ..X.......X.....</div>
<div class="line">[2022/11/24 07:06:03:9393] N: 0090: 4B 54 45 45 50 2D 44 65 76 69 63 65 48 53 65 63    KTEEP-DeviceHSec</div>
<div class="line">[2022/11/24 07:06:03:9393] N: 00A0: 75 72 65 46 53 50 8D 82 57 3A 92 6D 47 54 93 53    ureFSP..W:.mGT.S</div>
<div class="line">[2022/11/24 07:06:03:9393] N: 00B0: 32 DC 29 99 7F 74 42 74 61 04 58 56 86 14 A4 01    2.)..tBta.XV....</div>
<div class="line">[2022/11/24 07:06:03:9394] N: 00C0: 50 FA 6B 4A 53 D5 AD 5F DF BE 9D E6 63 E4 D4 1F    P.kJS.._....c...</div>
<div class="line">[2022/11/24 07:06:03:9394] N: 00D0: FE 02 50 14 92 AF 14 25 69 5E 48 BF 42 9B 2D 51    ..P....%i^H.B.-Q</div>
<div class="line">[2022/11/24 07:06:03:9394] N: 00E0: F2 AB 45 03 58 24 82 2F 58 20 00 11 22 33 44 55    ..E.X$./X ..3DU</div>
<div class="line">[2022/11/24 07:06:03:9394] N: 00F0: 66 77 88 99 AA BB CC DD EE FF 01 23 45 67 89 AB    fw.........#Eg..</div>
<div class="line">[2022/11/24 07:06:03:9394] N: 0100: CD EF FE DC BA 98 76 54 32 10 0E 19 87 D0 01 0F    ......vT2.......</div>
<div class="line">[2022/11/24 07:06:03:9394] N: 0110: 02 0F 09 58 54 86 13 A1 15 78 4A 68 74 74 70 3A    ...XT....xJhttp:</div>
<div class="line">[2022/11/24 07:06:03:9394] N: 0120: 2F 2F 74 61 6D 70 72 6F 74 6F 5F 74 61 6D 5F 61    //tamproto_tam_a</div>
<div class="line">[2022/11/24 07:06:03:9394] N: 0130: 70 69 5F 31 3A 38 38 38 38 2F 54 41 73 2F 38 64    pi_1:8888/TAs/8d</div>
<div class="line">[2022/11/24 07:06:03:9394] N: 0140: 38 32 35 37 33 61 2D 39 32 36 64 2D 34 37 35 34    82573a-926d-4754</div>
<div class="line">[2022/11/24 07:06:03:9394] N: 0150: 2D 39 33 35 33 2D 33 32 64 63 32 39 39 39 37 66    -9353-32dc29997f</div>
<div class="line">[2022/11/24 07:06:03:9394] N: 0160: 37 34 2E 74 61 15 02 03 0F 0A 43 82 03 0F 14 48    74.ta.....C....H</div>
<div class="line">[2022/11/24 07:06:03:9394] N: 0170: AB A1 A2 A3 A4 A5 A6 A7                            ........        </div>
<div class="line">[2022/11/24 07:06:03:9394] N: </div>
<div class="line">[2022/11/24 07:06:03:0110] N: GET: http://tamproto_tam_api_1:8888/TAs/8d82573a-926d-4754-9353-32dc29997f74.ta</div>
<div class="line">[2022/11/24 07:06:03:0110] N: http://tamproto_tam_api_1:8888/TAs/8d82573a-926d-4754-9353-32dc29997f74.ta</div>
<div class="line">[2022/11/24 07:06:03:0162] N: POST: http://tamproto_tam_api_1:8888/api/tam_cbor</div>
<div class="line">[2022/11/24 07:06:03:0162] N: </div>
<div class="line">[2022/11/24 07:06:03:0162] N: 0000: 82 05 A1 14 48 77 77 77 77 77 77 77 77             ....Hwwwwwwww   </div>
<div class="line">[2022/11/24 07:06:03:0162] N: </div>
<div class="line">[2022/11/24 07:06:03:0163] N: http://tamproto_tam_api_1:8888/api/tam_cbor</div>
<div class="line">[2022/11/24 07:06:03:0184] N: (hexdump: zero length)</div>
<div class="line">[CEnclavePool /home/user/linux-sgx/psw/urts/enclave.cpp:627] enter CEnclavePool constructor</div>
<div class="line">[build_secs /home/user/linux-sgx/psw/urts/loader.cpp:516] Enclave start addr. = 0x7f62b5a94000, Size = 0x8000000, 131072 KB</div>
<div class="line">TTRC:verifying signature of suit manifest</div>
<div class="line">TTRC:verify OK</div>
<div class="line">TTRC:command: 20</div>
<div class="line">TTRC:execute suit-set-parameters</div>
<div class="line">TTRC:command: 1</div>
<div class="line">TTRC:execute suit-condition-vendor-identifier</div>
<div class="line">TTRC:command: 2</div>
<div class="line">TTRC:execute suit-condition-class-identifier</div>
<div class="line">TTRC:command: 19</div>
<div class="line">TTRC:execute suit-set-parameters</div>
<div class="line">TTRC:command: 21</div>
<div class="line">TTRC:execute suit-directive-fetch</div>
<div class="line">TTRC:fetch_and_store component</div>
<div class="line">TTRC:component download 326768</div>
<div class="line">TTRC:ta-store.c: store_component() store component</div>
<div class="line">TTRC:  device   = TEEP-Device</div>
<div class="line">TTRC:  storage  = SecureFS</div>
<div class="line">TTRC:  filename = 8d82573a-926d-4754-9353-32dc29997f74.ta</div>
<div class="line">TTRC:  image_len = 326768</div>
<div class="line">TINF: ta-store.c: 138: install_ta(): Return value of ocall_open_file is : retval  = 0</div>
<div class="line">TTRC:finish fetch</div>
<div class="line">TTRC:command: 3</div>
<div class="line">TTRC:execute suit-condition-image-match</div>
<div class="line">TTRC:end of command seq</div>
<div class="line">ls -l /home/user/teep-device/sample/../build/sgx/agent </div>
<div class="line">total 1720</div>
<div class="line">-rw------- 1 build-user build-user 326768 Nov 24 07:06 8d82573a-926d-4754-9353-32dc29997f74.ta</div>
<div class="line">-rw-r--r-- 1 build-user build-user   8248 Nov 24 07:04 ta-store.o</div>
<div class="line">-rw-r--r-- 1 build-user build-user  59664 Nov 24 07:04 teep-agent-ta.o</div>
<div class="line">-rw-r--r-- 1 build-user build-user 675904 Nov 24 07:04 teep-agent-ta.signed.so</div>
<div class="line">-rwxr-xr-x 1 build-user build-user 675904 Nov 24 07:04 teep-agent-ta.so</div>
<div class="line">cd /home/user/teep-device/sample/../build/sgx/../../hello-tc/build-sgx/ &amp;&amp; \</div>
<div class="line">    cp /home/user/teep-device/sample/../build/sgx/agent/8d82573a-926d-4754-9353-32dc29997f74.ta</div>
<div class="line">    /home/user/teep-device/sample/../build/sgx/../../hello-tc/build-sgx/ &amp;&amp; \</div>
<div class="line">    ./App-sgx | \</div>
<div class="line">    tee -a /home/user/teep-device/sample/../build/sgx/sgx.log</div>
<div class="line">[parse_dyn /home/user/linux-sgx/psw/urts/parser/elfparser.cpp:176] dynamic tag = 19, ptr = 1faa8</div>
<div class="line">[parse_dyn /home/user/linux-sgx/psw/urts/parser/elfparser.cpp:176] dynamic tag = 1b, ptr = 0</div>
<div class="line">[parse_dyn /home/user/linux-sgx/psw/urts/parser/elfparser.cpp:176] dynamic tag = 1a, ptr = 1faa8</div>
<div class="line">[parse_dyn /home/user/linux-sgx/psw/urts/parser/elfparser.cpp:176] dynamic tag = 1c, ptr = 18</div>
<div class="line">[parse_dyn /home/user/linux-sgx/psw/urts/parser/elfparser.cpp:176] dynamic tag = 6ffffef5, ptr = 2e8</div>
<div class="line">[parse_dyn /home/user/linux-sgx/psw/urts/parser/elfparser.cpp:176] dynamic tag = 5, ptr = 3c8</div>
<div class="line">[parse_dyn /home/user/linux-sgx/psw/urts/parser/elfparser.cpp:176] dynamic tag = 6, ptr = 320</div>
<div class="line">[parse_dyn /home/user/linux-sgx/psw/urts/parser/elfparser.cpp:176] dynamic tag = a, ptr = 5c</div>
<div class="line">[parse_dyn /home/user/linux-sgx/psw/urts/parser/elfparser.cpp:176] dynamic tag = b, ptr = 18</div>
<div class="line">[parse_dyn /home/user/linux-sgx/psw/urts/parser/elfparser.cpp:176] dynamic tag = 15, ptr = 0</div>
<div class="line">[parse_dyn /home/user/linux-sgx/psw/urts/parser/elfparser.cpp:176] dynamic tag = 3, ptr = 1ff98</div>
<div class="line">[parse_dyn /home/user/linux-sgx/psw/urts/parser/elfparser.cpp:176] dynamic tag = 7, ptr = 470</div>
<div class="line">[parse_dyn /home/user/linux-sgx/psw/urts/parser/elfparser.cpp:176] dynamic tag = 8, ptr = 570</div>
<div class="line">[parse_dyn /home/user/linux-sgx/psw/urts/parser/elfparser.cpp:176] dynamic tag = 9, ptr = 18</div>
<div class="line">...</div>
<div class="line">...</div>
<div class="line">[setreate_enclave /home/user/linux-sgx/psw/urts/urts_com.h:332] add tcs 0x7fef9dcaa000</div>
<div class="line">[__create_enclave /home/user/linux-sgx/psw/urts/urts_com.h:332] add tcs 0x7fef9e0de000</div>
<div class="line">[__create_enclave /home/user/linux-sgx/psw/urts/urts_com.h:332] add tcs 0x7fef9e512000</div>
<div class="line">[__create_enclave /home/user/linux-sgx/psw/urts/urts_com.h:332] add tcs 0x7fef9e946000</div>
<div class="line">[__create_enclave /home/user/linux-sgx/psw/urts/urts_com.h:332] add tcs 0x7fef9ed7a000</div>
<div class="line">[__create_enclave /home/user/linux-sgx/psw/urts/urts_com.h:342] Debug enclave. Checking if VTune is profiling or SGX_DBG_OPTIN is set</div>
<div class="line">[__create_enclave /home/user/linux-sgx/psw/urts/urts_com.h:388] VTune is not profiling and SGX_DBG_OPTIN is not set. </div>
<div class="line">TCS Debug OPTIN bit not set and API to do module mapping not invoked</div>
<div class="line">[read_cpusvn_file ../cpusvn_util.cpp:96] Couldn&#39;t find/open the configuration file /home/user/.cpusvn.conf.</div>
<div class="line">[CEnclavePool /home/user/linux-sgx/psw/urts/enclave.cpp:627] enter CEnclavePool constructor</div>
<div class="line">[build_secs /home/user/linux-sgx/psw/urts/loader.cpp:516] Enclave start addr. = 0x7fef9b365000, Size = 0x8000000, 131072 KB</div>
<div class="line">main start</div>
<div class="line">Hello TEEP from TEE!</div>
<div class="line">main end</div>
<div class="line">Info: Enclave successfully returned.</div>
<div class="line">ls -l /home/user/teep-device/sample/../build/sgx/../../hello-tc/build-sgx</div>
<div class="line">total 1048</div>
<div class="line">-rw-r--r-- 1 build-user build-user 326768 Nov 24 07:06 8d82573a-926d-4754-9353-32dc29997f74.ta</div>
<div class="line">-rwxr-xr-x 1 build-user build-user  31128 Nov 24 07:04 App-sgx</div>
<div class="line">-rw-r--r-- 1 build-user build-user   4712 Nov 24 07:04 App-sgx.o</div>
<div class="line">-rw-rw-rw- 1 build-user build-user    149 Nov 24 06:44 Enclave.lds</div>
<div class="line">-rw-r--r-- 1 build-user build-user   3064 Nov 24 07:04 Enclave.o</div>
<div class="line">-rw-rw-rw- 1 build-user build-user   2455 Nov 24 06:44 Enclave_private.pem</div>
<div class="line">-rw-rw-rw- 1 build-user build-user    455 Nov 24 06:44 Makefile</div>
<div class="line">-rw-rw-rw- 1 build-user build-user   1080 Nov 24 06:44 app.mk</div>
<div class="line">drwxrwxrwx 2 build-user build-user   4096 Nov 24 06:44 config</div>
<div class="line">-rw-r--r-- 1 build-user build-user    282 Nov 24 07:04 download-tc.suit</div>
<div class="line">-rw-r--r-- 1 build-user build-user    761 Nov 24 07:04 download.json</div>
<div class="line">-rw-r--r-- 1 build-user build-user 326986 Nov 24 07:04 embed-tc.suit</div>
<div class="line">-rw-r--r-- 1 build-user build-user    209 Nov 24 07:04 embed-tc.suit.tmp</div>
<div class="line">-rw-r--r-- 1 build-user build-user    690 Nov 24 07:04 embed.json</div>
<div class="line">-rw-rw-rw- 1 build-user build-user   1917 Nov 24 06:44 enclave.mk</div>
<div class="line">-rw-r--r-- 1 build-user build-user    358 Nov 24 07:04 signed-download-tc.suit</div>
<div class="line">-rw-r--r-- 1 build-user build-user 327062 Nov 24 07:04 signed-embed-tc.suit</div>
<div class="line">if ! [ -f /home/user/teep-device/sample/../build/sgx/../../hello-tc/build-sgx/8d82573a-926d-4754-9353-32dc29997f74.ta ];</div>
<div class="line">    then \</div>
<div class="line">    echo ERR: No TC found | tee -a /home/user/teep-device/sample/../build/sgx/sgx.log; \</div>
<div class="line">fi</div>
<div class="line">! fgrep &#39;ERR:&#39; /home/user/teep-device/sample/../build/sgx/sgx.log</div>
<div class="line">fgrep &#39;Hello TEEP from TEE!&#39; /home/user/teep-device/sample/../build/sgx/sgx.log</div>
<div class="line">Hello TEEP from TEE!</div>
<div class="line">make[1]: Leaving directory &#39;/home/user/teep-device/sample&#39;</div>
</div><!-- fragment --><p >Cleaning built binaries. Deleting the built binaries are required when starting to build TEEP-Device on other CPU architectures otherwise will generate errors.</p>
<div class="fragment"><div class="line">$ make clean</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md29"></a>
Generate Documentation</h1>
<p >These TEEP-Device documentations in pdf and html format are generated by using Doxygen.</p>
<h2><a class="anchor" id="autotoc_md30"></a>
Start the container</h2>
<div class="fragment"><div class="line">docker run -it --rm -v $(pwd):/home/user/teep-device aistcpsec/teep-dev:doxygen</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md31"></a>
Generate pdf and html documentation</h2>
<div class="fragment"><div class="line">$ make docs</div>
</div><!-- fragment --><p >Location of created documentation.</p>
<div class="fragment"><div class="line">docs/teep-device.pdf</div>
<div class="line">docs/teep-device_readme_html.tar.gz</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
