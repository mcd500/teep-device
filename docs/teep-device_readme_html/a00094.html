<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>TEEP-DEVICE: Build TEEP-Device without Docker and for Development boards</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">TEEP-DEVICE
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('a00094.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Build TEEP-Device without Docker and for Development boards </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >Clone the TEEP-Device's source code and build it for Keystone, OP-TEE and SGX.</p>
<p >To build TEEP-Device for any TEE, the preparation of the TA-Ref sdk has to be done in advance. The detailed steps of building TA-Ref can be found in the TA-Ref documentation. Export the path of TA-Ref in the following environment variable.</p>
<div class="fragment"><div class="line">$ export TAREF_DIR=&lt;ta-ref dir&gt;</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md33"></a>
Prerequisite</h1>
<p >Have tested on Ubuntu 20.04.</p>
<p >Install packages for compiling.</p>
<div class="fragment"><div class="line">sudo apt-get -y install build-essential git autoconf automake cmake git wget curl expect python3-pip libcap-dev debian-ports-archive-keyring locales</div>
<div class="line">openssh-client openssh-server file libcurl4-gnutls-dev libjansson-dev rsync ntpdate usbutils pciutils net-tools iproute2 vim e2fsprogs</div>
</div><!-- fragment --><p ><b>Install suit-tool</b></p>
<p >The TEEP Messages use SUIT Manifest format for acquiring TCs. The suit-tools is used in TEEP-Device for parsing and handling SUIT Manifests.</p>
<div class="fragment"><div class="line"># Cloning suit-tool</div>
<div class="line">git clone https://git.gitlab.arm.com/research/ietf-suit/suit-tool.git</div>
<div class="line"> </div>
<div class="line"># Checkout the version of suit-tools compatible with current TEEP-Device</div>
<div class="line">cd suit-tool</div>
<div class="line">git checkout ca66a97bac153864617e7868e44f4b409e3e6ed4 -b for-teep-device</div>
<div class="line">python3 -m pip install --upgrade .</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md34"></a>
Run tamproto (TAM Server) - Required by all Kestone/OP-TEE/SGX</h1>
<p >Running a tamproto on a separate terminal is required as when the TEEP_Device is executed which communicates with the tamproto server to install the TC's.</p>
<div class="fragment"><div class="line"># Clone the tamproto repo and checkout master branch</div>
<div class="line">$ git clone https://github.com/ko-isobe/tamproto.git</div>
<div class="line">$ cd tamproto</div>
<div class="line">$ git checkout master</div>
<div class="line">$ docker-compose build</div>
<div class="line">$ docker-compose up</div>
</div><!-- fragment --><p >Once the TAM server is up, it will wait for incoming packets from TEEP-Device.</p>
<div class="fragment"><div class="line">naga@smartie:~/Aist_Dev/test/tamproto$ docker-compose up</div>
<div class="line">Starting tamproto_tam_api_1 ... done</div>
<div class="line">Attaching to tamproto_tam_api_1</div>
<div class="line">tam_api_1  | { &#39;supported-cipher-suites&#39;: 1,</div>
<div class="line">tam_api_1  |   challenge: 2,</div>
<div class="line">tam_api_1  |   versions: 3,</div>
<div class="line">tam_api_1  |   &#39;ocsp-data&#39;: 4,</div>
<div class="line">tam_api_1  |   &#39;selected-cipher-suite&#39;: 5,</div>
<div class="line">tam_api_1  |   &#39;selected-version&#39;: 6,</div>
<div class="line">tam_api_1  |   evidence: 7,</div>
<div class="line">tam_api_1  |   &#39;tc-list&#39;: 8,</div>
<div class="line">tam_api_1  |   &#39;ext-list&#39;: 9,</div>
<div class="line">tam_api_1  |   &#39;manifest-list&#39;: 10,</div>
<div class="line">tam_api_1  |   msg: 11,</div>
<div class="line">tam_api_1  |   &#39;err-msg&#39;: 12,</div>
<div class="line">tam_api_1  |   &#39;evidence-format&#39;: 13,</div>
<div class="line">tam_api_1  |   &#39;requested-tc-list&#39;: 14,</div>
<div class="line">tam_api_1  |   &#39;unneeded-tc-list&#39;: 15,</div>
<div class="line">tam_api_1  |   &#39;component-id&#39;: 16,</div>
<div class="line">tam_api_1  |   &#39;tc-manifest-sequence-number&#39;: 17,</div>
<div class="line">tam_api_1  |   &#39;have-binary&#39;: 18,</div>
<div class="line">tam_api_1  |   &#39;suit-reports&#39;: 19,</div>
<div class="line">tam_api_1  |   token: 20,</div>
<div class="line">tam_api_1  |   &#39;supported-freshness-mechanisms&#39;: 21 }</div>
<div class="line">tam_api_1  | Loading KeyConfig</div>
<div class="line">tam_api_1  | { TAM_priv: &#39;test-jw_tsm_identity_private_tam-mytam-private.jwk&#39;,</div>
<div class="line">tam_api_1  |   TAM_pub: &#39;test-jw_tsm_identity_tam-mytam-public.jwk&#39;,</div>
<div class="line">tam_api_1  |   TEE_priv: &#39;teep.jwk&#39;,</div>
<div class="line">tam_api_1  |   TEE_pub: &#39;teep.jwk&#39; }</div>
<div class="line">tam_api_1  | Load key TAM_priv</div>
<div class="line">tam_api_1  | Load key TAM_pub</div>
<div class="line">tam_api_1  | Load key TEE_priv</div>
<div class="line">tam_api_1  | Load key TEE_pub</div>
<div class="line">tam_api_1  | Key binary loaded</div>
<div class="line">tam_api_1  | 192.168.11.4</div>
<div class="line">tam_api_1  | Express HTTP  server listening on port 8888</div>
<div class="line">tam_api_1  | Express HTTPS server listening on port 8443</div>
<div class="line">tam_api_1  | GET /api/ 200 5.239 ms - 24</div>
</div><!-- fragment --><p >Please keep opening this terminal running tamproto. Cloning and building the TEEP-Device will be done on separate terminals.</p>
<h1><a class="anchor" id="autotoc_md35"></a>
Keystone</h1>
<p >Instruction to build <code>TEEP-Device</code> with Keystone. The Keystone and its supporting sources must be built and installed on the build environment beforehand. Refer to the Keystone section of the "Preparation before building TA-Ref without Docker" in the TA-Ref document.</p>
<h2><a class="anchor" id="autotoc_md36"></a>
Clone and Build</h2>
<p >Prepare the environment setup.</p>
<div class="fragment"><div class="line">$ export TEE=keystone</div>
<div class="line">$ export KEYSTONE_DIR=&lt;path to keystone dir&gt;</div>
<div class="line">$ export PATH=$PATH:$KEYSTONE_DIR/riscv/bin</div>
<div class="line">$ export KEYEDGE_DIR=&lt;path to keyedge dir&gt;</div>
</div><!-- fragment --><p >Clone and Build</p>
<div class="fragment"><div class="line"># Clone the TEEP-Device</div>
<div class="line">$ git clone https://github.com/mcd500/teep-device.git</div>
<div class="line">$ cd teep-device</div>
<div class="line">$ git checkout master</div>
<div class="line"> </div>
<div class="line"># Sync and update the submodules</div>
<div class="line">$ git submodule sync --recursive</div>
<div class="line">$ git submodule update --init --recursive</div>
<div class="line"> </div>
<div class="line"># Build the TEEP-Device</div>
<div class="line">$ make</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md37"></a>
Run hello-app &amp; teep-broker-app on QEMU Environment</h2>
<p >To check TEEP-Device on Keystone, we need to run TAM server on PC.</p>
<div class="fragment"><div class="line"># After the successful build</div>
<div class="line">$ make run-sample-session</div>
</div><!-- fragment --><p >Trimmed output printing 'Hello TEEP from TEE!'</p>
<div class="fragment"><div class="line">Welcome to Buildroot</div>
<div class="line">buildroot login: root</div>
<div class="line">Password: sifive</div>
<div class="line"> </div>
<div class="line">#### insmod keystone-driver.ko || echo &#39;err&#39;&#39;or&#39;</div>
<div class="line">[    5.350967] keystone_driver: loading out-of-tree module taints kernel.</div>
<div class="line">[    5.358283] keystone_enclave: keystone enclave v1.0.0</div>
<div class="line">#### cd /root/teep-device</div>
<div class="line">#### ls -l</div>
<div class="line">total 1367</div>
<div class="line">-rwxr-xr-x    1 root     root         98088 Feb 15  2022 eyrie-rt</div>
<div class="line">-rwxr-xr-x    1 root     root        437480 Feb 15  2022 hello-app</div>
<div class="line">-rwxr-xr-x    1 root     root        152016 Feb 15  2022 hello-ta</div>
<div class="line">-rwxr-xr-x    1 root     root        247416 Feb 15  2022 teep-agent-ta</div>
<div class="line">-rwxr-xr-x    1 root     root        470568 Feb 15  2022 teep-broker-app</div>
<div class="line">#### ./hello-app hello-ta eyrie-rt</div>
<div class="line">[debug] UTM : 0xffffffff80000000-0xffffffff80100000 (1024 KB) (boot.c:127)</div>
<div class="line">[debug] DRAM: 0x179800000-0x179c00000 (4096 KB) (boot.c:128)</div>
<div class="line">[debug] FREE: 0x1799bd000-0x179c00000 (2316 KB), va 0xffffffff001bd000 (boot.c:133)</div>
<div class="line">[debug] eyrie boot finished. drop to the user land ... (boot.c:172)</div>
<div class="line"> </div>
<div class="line">Hello TEEP from TEE!</div>
<div class="line"> </div>
<div class="line">#### ./hello-app 8d82573a-926d-4754-9353-32dc29997f74.ta eyrie-rt</div>
<div class="line">[Keystone SDK] /home/user/keystone/sdk/src/host/ElfFile.cpp:26 : file does not exist - 8d82573a-926d-4754-9353-32dc29997f74.ta</div>
<div class="line">[Keystone SDK] /home/user/keystone/sdk/src/host/Enclave.cpp:209 : Invalid enclave ELF</div>
<div class="line">./hello-app: Unable to start enclave</div>
<div class="line"> </div>
<div class="line">#### ./teep-broker-app --tamurl http://tamproto_tam_api_1:8888/api/tam_cbor</div>
<div class="line">teep-broker.c compiled at Feb 15 2022 10:07:55</div>
<div class="line">uri = http://tamproto_tam_api_1:8888/api/tam_cbor, cose=0, talist=</div>
<div class="line">[debug] UTM : 0xffffffff80000000-0xffffffff80100000 (1024 KB) (boot.c:127)</div>
<div class="line">[debug] DRAM: 0x179800000-0x179c00000 (4096 KB) (boot.c:128)</div>
<div class="line">[debug] FREE: 0x1799c6000-0x179c00000 (2280 KB), va 0xffffffff001c6000 (boot.c:133)</div>
<div class="line">[debug] eyrie boot finished. drop to the user land ... (boot.c:172)</div>
<div class="line"> </div>
<div class="line">&lt;output trimmed&gt;</div>
<div class="line"> </div>
<div class="line">#### ls -l</div>
<div class="line">total 1517</div>
<div class="line">-rw-------    1 root     root        152016 Jan  1 00:00 8d82573a-926d-4754-9353-32dc29997f74.ta</div>
<div class="line">-rwxr-xr-x    1 root     root         98088 Feb 15  2022 eyrie-rt</div>
<div class="line">-rwxr-xr-x    1 root     root        437480 Feb 15  2022 hello-app</div>
<div class="line">-rwxr-xr-x    1 root     root        152016 Feb 15  2022 hello-ta</div>
<div class="line">-rwxr-xr-x    1 root     root        247416 Feb 15  2022 teep-agent-ta</div>
<div class="line">-rwxr-xr-x    1 root     root        470568 Feb 15  2022 teep-broker-app</div>
<div class="line">#### ./hello-app 8d82573a-926d-4754-9353-32dc29997f74.ta eyrie-rt</div>
<div class="line">[debug] UTM : 0xffffffff80000000-0xffffffff80100000 (1024 KB) (boot.c:127)</div>
<div class="line">[debug] DRAM: 0x179800000-0x179c00000 (4096 KB) (boot.c:128)</div>
<div class="line">[debug] FREE: 0x1799bd000-0x179c00000 (2316 KB), va 0xffffffff001bd000 (boot.c:133)</div>
<div class="line">[debug] eyrie boot finished. drop to the user land ... (boot.c:172)</div>
<div class="line"> </div>
<div class="line">Hello TEEP from TEE!</div>
<div class="line"> </div>
<div class="line">97f74.ta.secstor.plain-4754-9353-32dc29997f74.ta 8d82573a-926d-4754-9353-32dc2999</div>
<div class="line">cmp: 8d82573a-926d-4754-9353-32dc29997f74.ta.secstor.plain: No such file or directory</div>
<div class="line">####  done</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md38"></a>
Run hello-app and teep-broker-app on RISC-V Unleashed</h2>
<p >To check TEEP-Device on Unleashed, we need to run TAM server (refer above to run tamproto) and networking with Unleashed dev board</p>
<h3><a class="anchor" id="autotoc_md39"></a>
Copy the hello-app and teep-broker-app binaries to Unleashed</h3>
<p ><b>Manual Copy</b></p>
<ul>
<li>Connect to Unleased over serial console then assign IP address <code>ifconfig eth0 192.168.0.6</code></li>
<li>Copy the binaries from build PC over SSH (user:root, password: sifive)</li>
</ul>
<p >Here <code>192.168.0.6</code> is IP Address of Unleased board</p>
<div class="fragment"><div class="line">$ scp platform/keystone/build/hello-ta/hello-ta root@192.168.0.6:/root/teep-device</div>
<div class="line">$ scp platform/keystone/build/hello-app/hello-app root@192.168.0.6:/root/teep-device</div>
<div class="line">$ scp platform/keystone/build/teep-agent-ta/teep-agent-ta root@192.168.0.6:/root/teep-device</div>
<div class="line">$ scp platform/keystone/build/teep-broker-app/teep-broker-app root@192.168.0.6:/root/teep-device</div>
<div class="line"> </div>
<div class="line">$ scp $KEYSTONE_DIR/sdk/rts/eyrie/eyrie-rt root@192.168.0.6:/root/teep-device</div>
<div class="line">$ scp platform/keystone/build/libteep/ree/mbedtls/library/lib* root@192.168.0.6:/usr/lib/</div>
<div class="line">$ scp platform/keystone/build/libteep/ree/libwebsockets/lib/lib* root@192.168.0.6:/usr/lib/</div>
</div><!-- fragment --><p ><b>Write to SD card</b></p>
<p >Please follow below steps to write the TEEP-Device binaries to SD-card</p>
<ul>
<li>Insert SD card to your PC for Unleashed</li>
<li>Edit <code>platform/keystone/script/sktinst.sh</code></li>
<li>Check SD-card device name detected on yor PC and fix <code>prefix=?</code></li>
<li><code>export prefix=/dev/mmcblk0</code></li>
<li>execute <code>script/sktinst.sh</code> as follows</li>
<li><code>cd platform/keystone; script/sktinst.sh</code></li>
<li>Move the sd to unleashed board and boot it</li>
</ul>
<h3><a class="anchor" id="autotoc_md40"></a>
Run hello-app and teep-broker-app on Unleased</h3>
<p >There are two methods to connect to Unleased.</p><ul>
<li>Serial Port using minicom (/dev/ttyUSB0)</li>
<li>Over SSH: <code>ssh root@192.168.0.6</code>; password is <code>sifive</code></li>
</ul>
<p >Setup environment in Unleashed (create /root/env.sh file and add following lines)</p>
<div class="fragment"><div class="line">$ export PATH=$PATH:/root/teep-device</div>
<div class="line">$ export TAM_IP=tamproto_tam_api_1</div>
<div class="line">$ export TAM_PORT=8888</div>
<div class="line">$ insmod keystone-driver.ko</div>
</div><!-- fragment --><p ><b>Run hello-app</b></p>
<div class="fragment"><div class="line">$ source env.sh</div>
<div class="line">[ 2380.618514] keystone_driver: loading out-of-tree module taints kernel.</div>
<div class="line">[ 2380.625305] keystone_enclave: keystone enclave v0.2</div>
<div class="line"> </div>
<div class="line">$ cd teep-broker/</div>
<div class="line"> </div>
<div class="line">$ ./hello-app hello-ta eyrie-rt</div>
<div class="line">Hello TEEP from TEE!</div>
<div class="line">$</div>
</div><!-- fragment --><p ><b>Run teep-broker-app</b></p>
<p >Use the TAM server IP address (i.e 192.168.11.4)</p>
<div class="fragment"><div class="line">$ ./teep-broker-app --tamurl http://192.168.11.4:8888/api/tam_cbor</div>
</div><!-- fragment --><p >Upon execution, you see following log</p>
<div class="fragment"><div class="line">teep-bro[ 2932.269897] ------------[ cut here ]------------</div>
<div class="line">[ 2932.274191] WARNING: CPU: 4 PID: 164</div>
<div class="line">[ 2932.287053] Modules linked in: keystone_driver(O)</div>
<div class="line">[ 2932.291716] CPU: 4 PID: 164 Comm: teep-broker-app Tainted: G</div>
<div class="line">[ 2932.301867] Call Trace:</div>
<div class="line">[ 2932.304314] [&lt;0000000036e46dc0&gt;] walk_stackframe+0x0/0xa2</div>
<div class="line">[ 2932.309686] [&lt;00000000893dfe1c&gt;] show_stack+0x26/0x34</div>
<div class="line">[ 2932.314725] [&lt;00000000c57ed7ce&gt;] dump_stack+0x5e/0x7c</div>
<div class="line">[ 2932.319759] [&lt;00000000a68ce031&gt;] __warn+0xca/0xe0</div>
<div class="line">[ 2932.324445] [&lt;00000000bec1f8a6&gt;] warn_slowpath_null+0x2c/0x3e</div>
<div class="line">[ 2932.330176] [&lt;00000000e8c56bf2&gt;] __alloc_pages_nodemask+0x14c/0x8da</div>
<div class="line">[ 2932.336426] [&lt;00000000ec1f9596&gt;] __get_free_pages+0xc/0x52</div>
<div class="line">[ 2932.341920] [&lt;000000003e8cccc8&gt;] epm_init+0x158/0x1a0 [keystone_driver]</div>
<div class="line">[ 2932.348502] [&lt;0000000032e4188b&gt;] create_enclave+0x56/0xb0 [keystone_driver]</div>
<div class="line">[ 2932.355447] [&lt;000000008a656a96&gt;] keystone_create_enclave+0x16/0x40 [keystone_driver]</div>
<div class="line">[ 2932.363174] [&lt;000000003bbf2147&gt;] keystone_ioctl+0x132/0x164 [keystone_driver]</div>
<div class="line">[ 2932.370288] [&lt;00000000755f7993&gt;] do_vfs_ioctl+0x76/0x4f4</div>
<div class="line">[ 2932.375582] [&lt;00000000b88b9c1d&gt;] SyS_ioctl+0x36/0x60</div>
<div class="line">[ 2932.380533] [&lt;00000000aae667a5&gt;] check_syscall_nr+0x1e/0x22</div>
<div class="line">[ 2932.386132] ---[ end trace 66814e3a8c80ec12 ]---</div>
<div class="line">ker.c compiled at Feb 16 2021 11:17:21</div>
<div class="line">uri = http://192.168.11.4:8888/api/tam_cbor, cose=0, talist=</div>
<div class="line">[1970/01/01 00:48:56:0796] NOTICE: POST: http://192.168.11.4:8888/api/tam_cbor</div>
<div class="line">[1970/01/01 00:48:56:0798] NOTICE: (hexdump: zero length)</div>
<div class="line">[1970/01/01 00:48:56:0801] NOTICE: created client ssl context for default</div>
<div class="line">[1970/01/01 00:48:56:0802] NOTICE: http://192.168.11.4:8888/api/tam_cbor</div>
<div class="line">[1970/01/01 00:48:56:0861] NOTICE:</div>
<div class="line">[1970/01/01 00:48:56:0862] NOTICE: 0000: 83 01 A4 01 81 01 03 81 00 14 1A 77 77 77 77 04    ...........wwww.</div>
<div class="line">[1970/01/01 00:48:56:0862] NOTICE: 0010: 43 01 02 03 02                                     C....</div>
<div class="line">[1970/01/01 00:48:56:0862] NOTICE:</div>
<div class="line">[1970/01/01 00:48:56:0871] NOTICE: POST: http://192.168.11.4:8888/api/tam_cbor</div>
<div class="line">[1970/01/01 00:48:56:0871] NOTICE:</div>
<div class="line">[1970/01/01 00:48:56:0871] NOTICE: 0000: 82 02 A4 14 1A 77 77 77 77 08 80 0E 80 0F 80       .....wwww......</div>
<div class="line">[1970/01/01 00:48:56:0872] NOTICE:</div>
<div class="line">[1970/01/01 00:48:56:0873] NOTICE: created client ssl context for default</div>
<div class="line">[1970/01/01 00:48:56:0874] NOTICE: http://192.168.11.4:8888/api/tam_cbor</div>
<div class="line">[1970/01/01 00:48:56:0962] NOTICE:</div>
<div class="line">[1970/01/01 00:48:56:0962] NOTICE: 0000: 82 03 A2 0A 81 59 01 37 A2 02 58 72 81 58 6F D2    .....Y.7..Xr.Xo.</div>
<div class="line">[1970/01/01 00:48:56:0963] NOTICE: 0010: 84 43 A1 01 26 A0 58 24 82 02 58 20 75 80 7C 54    .C..&amp;.X$..X u.|T</div>
<div class="line">[1970/01/01 00:48:56:0963] NOTICE: 0020: 62 40 D2 14 E5 7B D5 C4 6A 7C E5 2D ED B0 3D 0E    b@...{..j|.-..=.</div>
<div class="line">[1970/01/01 00:48:56:0964] NOTICE: 0030: CC 80 75 F3 F7 E0 65 B3 60 CE AD 85 58 40 54 81    ..u...e.`...X@T.</div>
<div class="line">[1970/01/01 00:48:56:0964] NOTICE: 0040: 49 CD CA D8 17 72 CC EA 61 4A 19 99 05 AB 97 33    I....r..aJ.....3</div>
<div class="line">[1970/01/01 00:48:56:0965] NOTICE: 0050: EA 48 D7 1F 13 AE 33 0D 47 FF F5 B8 6C 5C 9B 7A    .H....3.G...l\.z</div>
<div class="line">[1970/01/01 00:48:56:0965] NOTICE: 0060: BB 12 BC 2D FE 9C 20 6A C8 7F E2 28 58 74 E0 74    ...-.. j...(Xt.t</div>
<div class="line">[1970/01/01 00:48:56:0965] NOTICE: 0070: A3 BD C4 DA B9 20 C4 37 35 8F 67 46 90 76 03 58    ..... .75.gF.v.X</div>
<div class="line">[1970/01/01 00:48:56:0966] NOTICE: 0080: BE A5 01 01 02 01 03 58 60 A2 02 44 81 81 41 00    .......X`..D..A.</div>
<div class="line">[1970/01/01 00:48:56:0966] NOTICE: 0090: 04 58 56 86 14 A4 01 50 FA 6B 4A 53 D5 AD 5F DF    .XV....P.kJS.._.</div>
<div class="line">[1970/01/01 00:48:56:0967] NOTICE: 00A0: BE 9D E6 63 E4 D4 1F FE 02 50 14 92 AF 14 25 69    ...c.....P....%i</div>
<div class="line">[1970/01/01 00:48:56:0967] NOTICE: 00B0: 5E 48 BF 42 9B 2D 51 F2 AB 45 03 58 24 82 02 58    ^H.B.-Q..E.X$..X</div>
<div class="line">[1970/01/01 00:48:56:0968] NOTICE: 00C0: 20 00 11 22 33 44 55 66 77 88 99 AA BB CC DD EE     ..&quot;3DUfw.......</div>
<div class="line">[1970/01/01 00:48:56:0968] NOTICE: 00D0: FF 01 23 45 67 89 AB CD EF FE DC BA 98 76 54 32    ..#Eg........vT2</div>
<div class="line">[1970/01/01 00:48:56:0969] NOTICE: 00E0: 10 0E 19 87 D0 01 F6 02 F6 09 58 4E 86 13 A1 15    ..........XN....</div>
<div class="line">[1970/01/01 00:48:56:0969] NOTICE: 00F0: 78 44 68 74 74 70 3A 2F 2F 31 39 32 2E 31 36 38    xDhttp://192.168</div>
<div class="line">[1970/01/01 00:48:56:0970] NOTICE: 0100: 2E 31 31 2E 33 3A 38 38 38 38 2F 54 41 73 2F 38    .0.5:8888/TAs/8</div>
<div class="line">[1970/01/01 00:48:56:0970] NOTICE: 0110: 64 38 32 35 37 33 61 2D 39 32 36 64 2D 34 37 35    d82573a-926d-475</div>
<div class="line">[1970/01/01 00:48:56:0971] NOTICE: 0120: 34 2D 39 33 35 33 2D 33 32 64 63 32 39 39 39 37    4-9353-32dc29997</div>
<div class="line">[1970/01/01 00:48:56:0971] NOTICE: 0130: 66 37 34 2E 74 61 15 F6 03 F6 0A 43 82 03 F6 14    f74.ta.....C....</div>
<div class="line">[1970/01/01 00:48:56:0972] NOTICE: 0140: 1A 77 77 77 78                                     .wwwx</div>
<div class="line">[1970/01/01 00:48:56:0972] NOTICE:</div>
<div class="line">[1970/01/01 00:48:56:0983] NOTICE:</div>
<div class="line">GET: http://192.168.11.4:8888/TAs/8d82573a-926d-4754-9353-32dc29997f74.ta</div>
<div class="line">[1970/01/01 00:48:56:0984] NOTICE: created client ssl context for default</div>
<div class="line">[1970/01/01 00:48:56:0985] NOTICE:</div>
<div class="line">http://192.168.11.4:8888/TAs/8d82573a-926d-4754-9353-32dc29997f74.ta</div>
<div class="line">teep_message_unwrap_ta_image: msg len 234110</div>
<div class="line">Decrypt</div>
<div class="line">Decrypt OK: length 174887</div>
<div class="line">Verify</div>
<div class="line">Signature OK 0 130552</div>
<div class="line">ta_store_install: ta_image_len = 130552 ta_name=8d82573a-926d-4754-9353-32dc29997f74</div>
<div class="line">[1970/01/01 00:49:01:9453] NOTICE: POST: http://192.168.11.4:8888/api/tam_cbor</div>
<div class="line">[1970/01/01 00:49:01:9454] NOTICE:</div>
<div class="line">[1970/01/01 00:49:01:9454] NOTICE: 0000: 82 05 A1 14 1A 77 77 77 77                         .....wwww</div>
<div class="line">[1970/01/01 00:49:01:9454] NOTICE:</div>
<div class="line">[1970/01/01 00:49:01:9456] NOTICE: created client ssl context for default</div>
<div class="line">[1970/01/01 00:49:01:9457] NOTICE: http://192.168.11.4:8888/api/tam_cbor</div>
<div class="line">[1970/01/01 00:49:01:9505] NOTICE: (hexdump: zero length)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md41"></a>
OP-TEE</h1>
<p >Instruction to build <code>TEEP-Device</code> with OP-TEE. The OP-TEE and its supporting sources must be built and installed on the build environment beforehand. Refer to the OP-TEE section of the "Preparation before building TA-Ref without Docker" in the TA-Ref document.</p>
<h2><a class="anchor" id="autotoc_md42"></a>
Clone and Build</h2>
<p >Prepare the environment setup</p>
<div class="fragment"><div class="line">$ export TEE=optee</div>
<div class="line">$ export OPTEE_DIR=&lt;optee_dir&gt;</div>
<div class="line">$ export PATH=$PATH:$OPTEE_DIR/toolchains/aarch64/bin:$OPTEE_DIR/toolchains/aarch32/bin</div>
</div><!-- fragment --><p >Clone and Build</p>
<div class="fragment"><div class="line"># Clone the TEEP-Device</div>
<div class="line">$ git clone https://github.com/mcd500/teep-device.git</div>
<div class="line">$ cd teep-device</div>
<div class="line">$ git checkout master</div>
<div class="line"> </div>
<div class="line"># Sync and update the submodules</div>
<div class="line">$ git submodule sync --recursive</div>
<div class="line">$ git submodule update --init --recursive</div>
<div class="line"> </div>
<div class="line"># Build the TEEP-Device</div>
<div class="line">$ make</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md43"></a>
Run hello-app &amp; teep-broker-app on QEMU Environment</h2>
<p >To check TEEP-Device on OP-TEE, we need to run TAM server on PC.</p>
<div class="fragment"><div class="line"># Install the TA on qemu</div>
<div class="line">$ make optee_install_qemu</div>
<div class="line"> </div>
<div class="line"># After the successful build</div>
<div class="line"># Test the TEEP-Device</div>
<div class="line">$ make run-sample-session</div>
</div><!-- fragment --><p >Trimmed output of the test</p>
<div class="fragment"><div class="line">make -C sample run-session TAM_URL=http://172.17.0.32:8888</div>
<div class="line">make[1]: Entering directory &#39;/builds/rinkai/teep-device/sample&#39;</div>
<div class="line">make -C /builds/rinkai/teep-device/sample/../hello-tc/build-optee</div>
<div class="line"> SOURCE=/builds/rinkai/teep-device/sample/../hello-tc upload-download-manifest</div>
<div class="line">make[2]: Entering directory &#39;/builds/rinkai/teep-device/hello-tc/build-optee&#39;</div>
<div class="line">curl http://172.17.0.32:8888/panel/upload \</div>
<div class="line">    -F &quot;file=@/builds/rinkai/teep-device/hello-tc/build-optee/../../build/optee/hello-tc/signed-download-tc.suit;f</div>
<div class="line">    ilename=integrated-payload-manifest.cbor&quot;</div>
<div class="line">...</div>
<div class="line">...</div>
<div class="line">...</div>
<div class="line">cd /home/user/optee/out/bin &amp;&amp; \</div>
<div class="line">    QEMU=/home/user/optee/qemu/aarch64-softmmu/qemu-system-aarch64 \</div>
<div class="line">    QEMU_SMP=2 \</div>
<div class="line">    TAM_URL=http://172.17.0.32:8888 \</div>
<div class="line">    ROOTFS=/builds/rinkai/teep-device/sample/../build/optee/rootfs.cpio.gz \</div>
<div class="line">    expect /builds/rinkai/teep-device/sample/session/test-optee.expect</div>
<div class="line">Starting QEMU...</div>
<div class="line">..</div>
<div class="line">..</div>
<div class="line">FI stub: Booting Linux Kernel...</div>
<div class="line">EFI stub: EFI_RNG_PROTOCOL unavailable, no randomness supplied</div>
<div class="line">EFI stub: Using DTB from configuration table</div>
<div class="line">EFI stub: Exiting boot services and installing virtual address map...</div>
<div class="line">Starting syslogd: OK</div>
<div class="line">Starting klogd: OK</div>
<div class="line">Initializing random number generator... [    3.248115] random: dd: uninitialized urandom read (512 bytes read)</div>
<div class="line">done.</div>
<div class="line">Set permissions on /dev/tee*: OK</div>
<div class="line">Set permissions on /dev/ion: OK</div>
<div class="line">Create/set permissions on /data/tee: OK</div>
<div class="line">Starting tee-supplicant: OK</div>
<div class="line">Starting network: OK</div>
<div class="line">Starting network (udhcpc): OK</div>
<div class="line">Welcome to Buildroot, type root or test to login</div>
<div class="line">buildroot login: root</div>
<div class="line">#  done, guest is booted.</div>
<div class="line">export LD_LIBRARY_PATH=/lib:/lib/arm-linux-gnueabihf:/lib/optee_armtz:/usr/lib</div>
<div class="line"># cd teep-broker</div>
<div class="line"># ls -l</div>
<div class="line">total 4228</div>
<div class="line">-rwxr-xr-x    1 root     root           567 Nov 24 07:27 cp_ta_to_tamproto.sh</div>
<div class="line">-rwxr-xr-x    1 root     root           146 Nov 24 07:27 env.sh</div>
<div class="line">-rwxr-xr-x    1 root     root           290 Nov 24 07:27 get-ip.sh</div>
<div class="line">-rwxr-xr-x    1 root     root         14112 Nov 24 07:27 hello-app</div>
<div class="line">-rwxr-xr-x    1 root     root            65 Nov 24 07:27 itc.sh</div>
<div class="line">-rwxr-xr-x    1 root     root           116 Nov 24 07:27 rtc.sh</div>
<div class="line">-rwxr-xr-x    1 root     root           134 Nov 24 07:27 showtamurl.sh</div>
<div class="line">-rwxr-xr-x    1 root     root       4285528 Nov 24 07:27 teep-broker-app</div>
<div class="line"># ./hello-app</div>
<div class="line">hello-app: TEEC_Opensession failed with code 0xffff0008 origin 0x3</div>
<div class="line"># ./teep-broker-app --tamurl http://172.17.0.32:8888/api/tam_cbor</div>
<div class="line">teep-broker.c compiled at Nov 24 2022 07:27:53</div>
<div class="line">uri = http://172.17.0.32:8888/api/tam_cbor, cose=0, talist=</div>
<div class="line">[2022/11/24 07:28:26:9408] N: POST: http://172.17.0.32:8888/api/tam_cbor</div>
<div class="line">[2022/11/24 07:28:26:9425] N: (hexdump: zero length)</div>
<div class="line">[2022/11/24 07:28:26:9506] N: http://172.17.0.32:8888/api/tam_cbor</div>
<div class="line">[2022/11/24 07:28:26:0224] N: </div>
<div class="line">[2022/11/24 07:28:26:0234] N: 0000: 83 01 A5 01 81 01 03 81 00 04 43 01 02 05 14 48    ..........C....H</div>
<div class="line">[2022/11/24 07:28:26:0243] N: 0010: 77 77 77 77 77 77 77 77 15 81 00 02                wwwwwwww....    </div>
<div class="line">[2022/11/24 07:28:26:0250] N: </div>
<div class="line">[2022/11/24 07:28:26:0374] N: POST: http://172.17.0.32:8888/api/tam_cbor</div>
<div class="line">[2022/11/24 07:28:26:0379] N: </div>
<div class="line">[2022/11/24 07:28:26:0382] N: 0000: 82 02 A4 14 48 77 77 77 77 77 77 77 77 08 80 0E    ....Hwwwwwwww...</div>
<div class="line">[2022/11/24 07:28:26:0389] N: 0010: 80 0F 80                                           ...             </div>
<div class="line">[2022/11/24 07:28:26:0395] N: </div>
<div class="line">[2022/11/24 07:28:26:0417] N: http://172.17.0.32:8888/api/tam_cbor</div>
<div class="line">[2022/11/24 07:28:27:0742] N: </div>
<div class="line">[2022/11/24 07:28:27:0746] N: 0000: 82 03 A2 0A 81 59 01 5F D8 6B A2 02 58 73 82 58    .....Y._.k..Xs.X</div>
<div class="line">[2022/11/24 07:28:27:0751] N: 0010: 24 82 2F 58 20 D7 FC F7 75 1E CB 77 96 39 A4 0F    $./X ...u..w.9..</div>
<div class="line">[2022/11/24 07:28:27:0758] N: 0020: 58 66 56 EF D3 08 7D 31 ED C3 C4 5B EE DD 9E 95    XfV...}1...[....</div>
<div class="line">[2022/11/24 07:28:27:0767] N: 0030: 38 CE 0D 3E 8A 58 4A D2 84 43 A1 01 26 A0 F6 58    8..&gt;.XJ..C..&amp;..X</div>
<div class="line">[2022/11/24 07:28:27:0774] N: 0040: 40 6F D3 76 AE AE CF F3 BC E7 7E 60 E1 22 0A 20    @o.v......~`.. </div>
<div class="line">[2022/11/24 07:28:27:0780] N: 0050: 1C 3C 10 3F 85 BE 71 A7 10 E5 6D C1 C5 0A A6 C6    .&lt;.?..q...m.....</div>
<div class="line">[2022/11/24 07:28:27:0786] N: 0060: 47 D4 D4 EE DD 20 2D 08 EA 4F 74 6F 48 FF 3D D3    G.... -..OtoH.=.</div>
<div class="line">[2022/11/24 07:28:27:0793] N: 0070: 32 B4 60 18 95 15 6A 5D 25 12 EF E8 8B 35 CE CD    2.`...j]%....5..</div>
<div class="line">[2022/11/24 07:28:27:0799] N: 0080: 1C 03 58 E3 A5 01 01 02 01 03 58 86 A2 02 81 84    ..X.......X.....</div>
<div class="line">[2022/11/24 07:28:27:0808] N: 0090: 4B 54 45 45 50 2D 44 65 76 69 63 65 48 53 65 63    KTEEP-DeviceHSec</div>
<div class="line">[2022/11/24 07:28:27:0815] N: 00A0: 75 72 65 46 53 50 8D 82 57 3A 92 6D 47 54 93 53    ureFSP..W:.mGT.S</div>
<div class="line">[2022/11/24 07:28:27:0821] N: 00B0: 32 DC 29 99 7F 74 42 74 61 04 58 56 86 14 A4 01    2.)..tBta.XV....</div>
<div class="line">[2022/11/24 07:28:27:0827] N: 00C0: 50 FA 6B 4A 53 D5 AD 5F DF BE 9D E6 63 E4 D4 1F    P.kJS.._....c...</div>
<div class="line">[2022/11/24 07:28:27:0833] N: 00D0: FE 02 50 14 92 AF 14 25 69 5E 48 BF 42 9B 2D 51    ..P....%i^H.B.-Q</div>
<div class="line">[2022/11/24 07:28:27:0840] N: 00E0: F2 AB 45 03 58 24 82 2F 58 20 00 11 22 33 44 55    ..E.X$./X ..3DU</div>
<div class="line">[2022/11/24 07:28:27:0847] N: 00F0: 66 77 88 99 AA BB CC DD EE FF 01 23 45 67 89 AB    fw.........#Eg..</div>
<div class="line">[2022/11/24 07:28:27:0853] N: 0100: CD EF FE DC BA 98 76 54 32 10 0E 19 87 D0 01 0F    ......vT2.......</div>
<div class="line">[2022/11/24 07:28:27:0859] N: 0110: 02 0F 09 58 4D 86 13 A1 15 78 43 68 74 74 70 3A    ...XM....xChttp:</div>
<div class="line">[2022/11/24 07:28:27:0865] N: 0120: 2F 2F 31 37 32 2E 31 37 2E 30 2E 33 32 3A 38 38    //172.17.0.32:88</div>
<div class="line">[2022/11/24 07:28:27:0871] N: 0130: 38 38 2F 54 41 73 2F 38 64 38 32 35 37 33 61 2D    88/TAs/8d82573a-</div>
<div class="line">[2022/11/24 07:28:27:0877] N: 0140: 39 32 36 64 2D 34 37 35 34 2D 39 33 35 33 2D 33    926d-4754-9353-3</div>
<div class="line">[2022/11/24 07:28:27:0884] N: 0150: 32 64 63 32 39 39 39 37 66 37 34 2E 74 61 15 02    2dc29997f74.ta..</div>
<div class="line">[2022/11/24 07:28:27:0890] N: 0160: 03 0F 0A 43 82 03 0F 14 48 AB A1 A2 A3 A4 A5 A6    ...C....H.......</div>
<div class="line">[2022/11/24 07:28:27:0896] N: 0170: A7                                                 .               </div>
<div class="line">[2022/11/24 07:28:27:0901] N: </div>
<div class="line">[2022/11/24 07:28:27:6609] N: GET: http://172.17.0.32:8888/TAs/8d82573a-926d-4754-9353-32dc29997f74.ta</div>
<div class="line">[2022/11/24 07:28:27:6632] N: http://172.17.0.32:8888/TAs/8d82573a-926d-4754-9353-32dc29997f74.ta</div>
<div class="line">[2022/11/24 07:28:27:7968] N: POST: http://172.17.0.32:8888/api/tam_cbor</div>
<div class="line">[2022/11/24 07:28:27:7973] N: </div>
<div class="line">[2022/11/24 07:28:27:7977] N: 0000: 82 05 A1 14 48 77 77 77 77 77 77 77 77             ....Hwwwwwwww   </div>
<div class="line">[2022/11/24 07:28:27:7982] N: </div>
<div class="line">[2022/11/24 07:28:27:7993] N: http://172.17.0.32:8888/api/tam_cbor</div>
<div class="line">[2022/11/24 07:28:27:8228] N: (hexdump: zero length)</div>
<div class="line"># ls -l</div>
<div class="line">total 4228</div>
<div class="line">-rwxr-xr-x    1 root     root           567 Nov 24 07:27 cp_ta_to_tamproto.sh</div>
<div class="line">-rwxr-xr-x    1 root     root           146 Nov 24 07:27 env.sh</div>
<div class="line">-rwxr-xr-x    1 root     root           290 Nov 24 07:27 get-ip.sh</div>
<div class="line">-rwxr-xr-x    1 root     root         14112 Nov 24 07:27 hello-app</div>
<div class="line">-rwxr-xr-x    1 root     root            65 Nov 24 07:27 itc.sh</div>
<div class="line">-rwxr-xr-x    1 root     root           116 Nov 24 07:27 rtc.sh</div>
<div class="line">-rwxr-xr-x    1 root     root           134 Nov 24 07:27 showtamurl.sh</div>
<div class="line">-rwxr-xr-x    1 root     root       4285528 Nov 24 07:27 teep-broker-app</div>
<div class="line"># ./hello-app</div>
<div class="line">#  done</div>
<div class="line">..</div>
<div class="line"> </div>
<div class="line">M/TA: TTRC:verifying signature of suit manifest</div>
<div class="line">M/TA: TTRC:verify OK</div>
<div class="line">M/TA: TTRC:command: 20</div>
<div class="line">M/TA: TTRC:execute suit-set-parameters</div>
<div class="line">M/TA: TTRC:command: 1</div>
<div class="line">M/TA: TTRC:execute suit-condition-vendor-identifier</div>
<div class="line">M/TA: TTRC:command: 2</div>
<div class="line">M/TA: TTRC:execute suit-condition-class-identifier</div>
<div class="line">M/TA: TTRC:command: 19</div>
<div class="line">M/TA: TTRC:execute suit-set-parameters</div>
<div class="line">M/TA: TTRC:command: 21</div>
<div class="line">M/TA: TTRC:execute suit-directive-fetch</div>
<div class="line">M/TA: TTRC:fetch_and_store component</div>
<div class="line">M/TA: TTRC:component download 55976</div>
<div class="line">M/TA: TTRC:ta-store.c: store_component() store component</div>
<div class="line">M/TA: TTRC:  device   = TEEP-Device</div>
<div class="line">M/TA: TTRC:  storage  = SecureFS</div>
<div class="line">M/TA: TTRC:  filename = 8d82573a-926d-4754-9353-32dc29997f74.ta</div>
<div class="line">M/TA: TTRC:  image_len = 55976</div>
<div class="line">D/TC:? 0 tee_ta_init_pseudo_ta_session:283 Lookup pseudo TA 6e256cba-fc4d-4941-ad09-2ca1860342dd</div>
<div class="line">D/TC:? 0 tee_ta_init_pseudo_ta_session:296 Open secstor_ta_mgmt</div>
<div class="line">D/TC:? 0 tee_ta_init_pseudo_ta_session:310 secstor_ta_mgmt : 6e256cba-fc4d-4941-ad09-2ca1860342dd</div>
<div class="line">D/TC:? 0 install_ta:99 Installing 8d82573a-926d-4754-9353-32dc29997f74</div>
<div class="line">D/TC:? 0 tee_ta_close_session:499 csess 0xc37ecfb0 id 1</div>
<div class="line">D/TC:? 0 tee_ta_close_session:518 Destroy session</div>
<div class="line">M/TA: TTRC:finish fetch</div>
<div class="line">M/TA: TTRC:command: 3</div>
<div class="line">M/TA: TTRC:execute suit-condition-image-match</div>
<div class="line">M/TA: TTRC:end of command seq</div>
<div class="line">D/TC:? 0 tee_ta_close_session:499 csess 0xc37eeb40 id 1</div>
<div class="line">D/TC:? 0 tee_ta_close_session:518 Destroy session</div>
<div class="line">D/TC:? 0 destroy_context:298 Destroy TA ctx (0xc37eeae0)</div>
<div class="line">D/TC:? 0 tee_ta_init_pseudo_ta_session:283 Lookup pseudo TA 8d82573a-926d-4754-9353-32dc29997f74</div>
<div class="line">D/TC:? 0 load_ldelf:704 ldelf load address 0x40006000</div>
<div class="line">D/LD:  ldelf:134 Loading TA 8d82573a-926d-4754-9353-32dc29997f74</div>
<div class="line">D/TC:? 0 tee_ta_init_session_with_context:573 Re-open TA 3a2f8978-5dc0-11e8-9c2d-fa7ae01bbebc</div>
<div class="line">D/TC:? 0 system_open_ta_binary:257 Lookup user TA ELF 8d82573a-926d-4754-9353-32dc29997f74 (Secure Storage TA)</div>
<div class="line">D/TC:? 0 system_open_ta_binary:260 res=0x0</div>
<div class="line">D/LD:  ldelf:169 ELF (8d82573a-926d-4754-9353-32dc29997f74) at 0x4004b000</div>
<div class="line">D/TC:? 0 tee_ta_close_session:499 csess 0xc37ec610 id 1</div>
<div class="line">D/TC:? 0 tee_ta_close_session:518 Destroy session</div>
<div class="line">Hello TEEP from TEE!</div>
<div class="line">D/TC:? 0 tee_ta_close_session:499 csess 0xc37ece10 id 1</div>
<div class="line">D/TC:? 0 tee_ta_close_session:518 Destroy session</div>
<div class="line">D/TC:? 0 destroy_context:298 Destroy TA ctx (0xc37ecdb0)</div>
<div class="line">! fgrep &#39;ERR:&#39; /home/user/optee/out/bin/serial1.log</div>
<div class="line">fgrep &#39;Hello TEEP from TEE!&#39; /home/user/optee/out/bin/serial1.log</div>
<div class="line">Hello TEEP from TEE!</div>
<div class="line">make[1]: Leaving directory &#39;/home/user/teep-device/sample&#39;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md44"></a>
Run hello-app and teep-broker-app on Raspberry PI 3</h2>
<p >The RPI3 board needs the following to boot. 1) Kernal Image - kernel8.img 2) DTB file for RPI3 - bcm2710-rpi-3-b-plus.dtb 3) Rootfs file system - arm64-20.04-rootfs-teep-device.tar.xz</p>
<p >You can copy the Kernal Image and DTB file from the <b>aistcpsec/tee-dev:optee-3.10.0_rpi3</b> image. It will located inside /home/user/optee/out-br/target/boot folder.</p>
<p >The rootfs file system can be downloaded from the docker image <b>aistcpsec/teep-dev:rootfs_teep-device_rpi3_netboot_nfs</b> It will be available in the / folder. Tar file name is arm64-20.04-rootfs-teep-device.tar.xz.</p>
<p >Please copy the above files from docker to your local using docker cp command.</p>
<p ><b>Partition SD Card</b></p>
<p >Partition the SD card into two partitions Partition 1 - Boot Partition - Place the Kernal Image file and DTB File Partition 2 - Rootfs file system - Copy the extracted arm64-20.04-rootfs-teep-device.tar.xz contents.</p>
<p ><b>Write to SD card</b> <br  />
 Please follow below steps to write the TEEP-Device binaries to SD-card</p><ul>
<li>Insert SD card to your PC for Unleashed</li>
<li>Copy the binaries to SD card</li>
<li>Move the SD card to Raspberry PI 3 board and boot it</li>
</ul>
<h3><a class="anchor" id="autotoc_md45"></a>
Run hello-app and teep-broker-app on Raspberry PI 3</h3>
<p >There are two methods to connect to Raspberry PI 3.</p><ul>
<li>Serial Port using minicom (/dev/ttyUSB0)</li>
<li>Over SSH: <code>ssh root@&lt;rpi3_ip_address&gt;</code></li>
</ul>
<p >In the below steps, let us consider the IP address of RPI3 connected system is 192.168.100.118 and the IP address of RPI3 is 192.168.100.114</p>
<p >Also, Tamproto Server is required to test the TEEP-Device. We can start the tamproto in the PC or we can start inside RPI3 itself. In our case, we will start the tamproto server inside the RPI3.</p>
<p ><b>Access the RPI3 Terminal - Using Minicom</b></p>
<p >When RPI3 is booting, we can access the RPI3 using the minicom. This is access from the PC to which the RPI3 is connected. Also /dev/ttyUSB0 is not fixed, it may be /dev/ttyUSB1 or 2 etc.</p>
<div class="fragment"><div class="line">$ minicom -D /dev/ttyUSB0</div>
<div class="line"> </div>
<div class="line">root@arm64-ubuntu:~# NOTICE:  Booting Trusted Firmware</div>
<div class="line">NOTICE:  BL1: v2.2(debug):v2.2</div>
<div class="line">NOTICE:  BL1: Built : 03:31:10, Nov 15 2022</div>
<div class="line">INFO:    BL1: RAM 0x100ee000 - 0x100f7000</div>
<div class="line">INFO:    BL1: cortex_a53: CPU workaround for 843419 was applied</div>
<div class="line">INFO:    BL1: cortex_a53: CPU workaround for 855873 was applied</div>
<div class="line">NOTICE:  rpi3: Detected: Raspberry Pi 3 Model B+ (1GB, Sony, UK) [0x00a020d3]</div>
<div class="line">INFO:    BL1: Loading BL2</div>
<div class="line">INFO:    Loading image id=1 at address 0x100b4000</div>
<div class="line">INFO:    Image id=1 loaded: 0x100b4000 - 0x100bc410</div>
<div class="line">NOTICE:  BL1: Booting BL2</div>
<div class="line">INFO:    Entry point address = 0x100b4000</div>
<div class="line">INFO:    SPSR = 0x3c5</div>
<div class="line">NOTICE:  BL2: v2.2(debug):v2.2</div>
<div class="line">NOTICE:  BL2: Built : 03:31:10, Nov 15 2022</div>
<div class="line">INFO:    BL2: Doing platform setup</div>
<div class="line">INFO:    BL2: Loading image id 3</div>
<div class="line">INFO:    Loading image id=3 at address 0x100e0000</div>
<div class="line">INFO:    Image id=3 loaded: 0x100e0000 - 0x100ea078</div>
<div class="line">INFO:    BL2: Loading image id 4</div>
<div class="line">INFO:    Loading image id=4 at address 0x10100000</div>
<div class="line">INFO:    Image id=4 loaded: 0x10100000 - 0x1010001c</div>
<div class="line">INFO:    OPTEE ep=0x10100000</div>
<div class="line">INFO:    OPTEE header info:</div>
<div class="line">INFO:          magic=0x4554504f</div>
<div class="line">INFO:          version=0x2</div>
<div class="line">INFO:          arch=0x1</div>
<div class="line"> </div>
<div class="line">arm64-ubuntu login: root</div>
<div class="line">Password: </div>
<div class="line">Welcome to Ubuntu 20.04.5 LTS (GNU/Linux 4.14.56-v8 aarch64)</div>
</div><!-- fragment --><p ><b>Access the RPI3 Terminal - Using SSH</b> After RPI3 is booted, we can access the RPI3 terminal using SSH</p>
<div class="fragment"><div class="line">$ ssh root@192.168.100.114</div>
<div class="line">root@192.168.100.114&#39;s password: </div>
<div class="line">Welcome to Ubuntu 20.04.5 LTS (GNU/Linux 4.14.56-v8 aarch64)</div>
<div class="line"> </div>
<div class="line"> * Documentation:  https://help.ubuntu.com</div>
<div class="line"> * Management:     https://landscape.canonical.com</div>
<div class="line"> * Support:        https://ubuntu.com/advantage</div>
<div class="line">Last login: Wed Aug 31 15:28:32 2022</div>
<div class="line">root@arm64-ubuntu:~# </div>
</div><!-- fragment --><p ><b>Starting the Tamproto Server</b></p>
<p >First, lets install npm and node server in RPI3. This is done by executing the ./install_node.sh file. </p><div class="fragment"><div class="line">$ # cd /home/user/./install_node.sh </div>
<div class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</div>
<div class="line">                                 Dload  Upload   Total   Spent    Left  Speed</div>
<div class="line">100 15916  100 15916    0     0  42329      0 --:--:-- --:--:-- --:--:-- 42217</div>
<div class="line">=&gt; Downloading nvm as script to &#39;/root/.nvm&#39;</div>
<div class="line"> </div>
<div class="line">=&gt; Appending nvm source string to /root/.bashrc</div>
<div class="line">=&gt; Appending bash_completion source string to /root/.bashrc</div>
<div class="line">=&gt; Close and reopen your terminal to start using nvm or run the following to use it now:</div>
<div class="line"> </div>
<div class="line">export NVM_DIR=&quot;$HOME/.nvm&quot;</div>
<div class="line">[ -s &quot;$NVM_DIR/nvm.sh&quot; ] &amp;&amp; \. &quot;$NVM_DIR/nvm.sh&quot;  # This loads nvm</div>
<div class="line">[ -s &quot;$NVM_DIR/bash_completion&quot; ] &amp;&amp; \. &quot;$NVM_DIR/bash_completion&quot;  # This loads nvm bash_completion</div>
<div class="line">Installing latest LTS version.</div>
<div class="line">Downloading and installing node v18.12.1...</div>
<div class="line">Downloading https://nodejs.org/dist/v18.12.1/node-v18.12.1-linux-arm64.tar.xz...</div>
<div class="line">########################################### 100.0%</div>
<div class="line">Computing checksum with sha256sum</div>
<div class="line">Checksums matched!</div>
<div class="line">Now using node v18.12.1 (npm v8.19.2)</div>
<div class="line">Creating default alias: default -&gt; lts/* (-&gt; v18.12.1)</div>
<div class="line">Now using node v18.12.1 (npm v8.19.2)</div>
<div class="line">root@arm64-ubuntu:/home/user# </div>
</div><!-- fragment --><p >Then install the node modules and start the tamproto server. </p><div class="fragment"><div class="line">root@arm64-ubuntu:/home/user# cd tamproto/</div>
<div class="line">root@arm64-ubuntu:/home/user/tamproto# ls</div>
<div class="line">Dockerfile  README.md  app.js       docker-compose.yml  keymanager.js      package.json        query_response.cbor  suit.cbor        teep-p.js</div>
<div class="line">LICENSE     TAs        config.json  key                 package-lock.json  query_request.cbor  routes               ta_install.cbor  views</div>
<div class="line">root@arm64-ubuntu:/home/user/tamproto# npm install</div>
<div class="line">added 154 packages, and audited 155 packages in 23s</div>
<div class="line"> </div>
<div class="line">13 packages are looking for funding</div>
<div class="line">  run `npm fund` for details</div>
<div class="line"> </div>
<div class="line">found 0 vulnerabilities</div>
<div class="line">npm notice </div>
<div class="line">npm notice New major version of npm available! 8.19.2 -&gt; 9.1.2</div>
<div class="line">npm notice Changelog: https://github.com/npm/cli/releases/tag/v9.1.2</div>
<div class="line">npm notice Run npm install -g npm@9.1.2 to update!</div>
<div class="line">npm notice </div>
<div class="line">root@arm64-ubuntu:/home/user/tamproto# </div>
<div class="line">root@arm64-ubuntu:/home/user/tamproto# node app.js</div>
<div class="line">{</div>
<div class="line">  &#39;supported-cipher-suites&#39;: 1,</div>
<div class="line">  challenge: 2,</div>
<div class="line">  versions: 3,</div>
<div class="line">  &#39;ocsp-data&#39;: 4,</div>
<div class="line">  &#39;selected-cipher-suite&#39;: 5,</div>
<div class="line">  &#39;selected-version&#39;: 6,</div>
<div class="line">  evidence: 7,</div>
<div class="line">  &#39;tc-list&#39;: 8,</div>
<div class="line">  &#39;ext-list&#39;: 9,</div>
<div class="line">  &#39;manifest-list&#39;: 10,</div>
<div class="line">  msg: 11,</div>
<div class="line">  &#39;err-msg&#39;: 12,</div>
<div class="line">  &#39;evidence-format&#39;: 13,</div>
<div class="line">  &#39;requested-tc-list&#39;: 14,</div>
<div class="line">  &#39;unneeded-tc-list&#39;: 15,</div>
<div class="line">  &#39;component-id&#39;: 16,</div>
<div class="line">  &#39;tc-manifest-sequence-number&#39;: 17,</div>
<div class="line">  &#39;have-binary&#39;: 18,</div>
<div class="line">  &#39;suit-reports&#39;: 19,</div>
<div class="line">  token: 20,</div>
<div class="line">  &#39;supported-freshness-mechanisms&#39;: 21</div>
<div class="line">}</div>
<div class="line">Loading KeyConfig</div>
<div class="line">{</div>
<div class="line">  TAM_priv: &#39;teep_ecP256.jwk&#39;,</div>
<div class="line">  TAM_pub: &#39;teep_ecP256.jwk&#39;,</div>
<div class="line">  TEE_priv: &#39;teep_ecP256.jwk&#39;,</div>
<div class="line">  TEE_pub: &#39;teep_agent_prime256v1_pub.pem&#39;</div>
<div class="line">}</div>
<div class="line">Load key TAM_priv</div>
<div class="line">Load key TAM_pub</div>
<div class="line">Load key TEE_priv</div>
<div class="line">Load key TEE_pub</div>
<div class="line">Key binary loaded</div>
<div class="line">(node:1098) Warning: Accessing non-existent property &#39;request&#39; of module exports inside circular dependency</div>
<div class="line">(Use `node --trace-warnings ...` to show where the warning was created)</div>
<div class="line">192.168.100.114</div>
<div class="line">Express HTTP  server listening on port 8888</div>
<div class="line">Express HTTPS server listening on port 8443</div>
</div><!-- fragment --><p ><b>Copy the TA's into Tamproto server</b></p>
<p >Open another terminal using ssh</p>
<div class="fragment"><div class="line">$ cd /home/user/teep-broker</div>
<div class="line">$ ./cp_ta_to_tamproto.sh</div>
</div><!-- fragment --><p ><b>Run the teep-broker-app</b></p>
<p >(Inside teep-broker folder) </p><div class="fragment"><div class="line">$ ./showtamurl.sh</div>
<div class="line">   --tamurl http://192.168.100.114:8888/api/tam_cbor</div>
<div class="line">$ ./teep-broker-app --tamurl http://192.168.100.114:8888/api/tam_cbor</div>
<div class="line">teep-broker.c compiled at Nov 24 2022 08:14:22</div>
<div class="line">uri = http://192.168.100.114:8888/api/tam_cbor, cose=0, talist=</div>
<div class="line">[2022/11/24 08:54:57:7358] N: POST: http://192.168.100.114:8888/api/tam_cbor</div>
<div class="line">[2022/11/24 08:54:57:7358] N: (hexdump: zero length)</div>
<div class="line">[2022/11/24 08:54:57:7369] N: http://192.168.100.114:8888/api/tam_cbor</div>
<div class="line">[2022/11/24 08:54:57:8365] N: </div>
<div class="line">[2022/11/24 08:54:57:8366] N: 0000: 83 01 A5 01 81 01 03 81 00 04 43 01 02 05 14 48    ..........C....H</div>
<div class="line">[2022/11/24 08:54:57:8366] N: 0010: 77 77 77 77 77 77 77 77 15 81 00 02                wwwwwwww....    </div>
<div class="line">[2022/11/24 08:54:57:8366] N: </div>
<div class="line">[2022/11/24 08:54:57:8375] N: POST: http://192.168.100.114:8888/api/tam_cbor</div>
<div class="line">[2022/11/24 08:54:57:8375] N: </div>
<div class="line">[2022/11/24 08:54:57:8376] N: 0000: 82 02 A4 14 48 77 77 77 77 77 77 77 77 08 80 0E    ....Hwwwwwwww...</div>
<div class="line">[2022/11/24 08:54:57:8376] N: 0010: 80 0F 80                                           ...             </div>
<div class="line">[2022/11/24 08:54:57:8376] N: </div>
<div class="line">[2022/11/24 08:54:57:8380] N: http://192.168.100.114:8888/api/tam_cbor</div>
<div class="line">[2022/11/24 08:54:57:9134] N: </div>
<div class="line">[2022/11/24 08:54:57:9135] N: 0000: 82 03 A2 0A 81 59 01 5D D8 6B A2 02 58 73 82 58    .....Y.].k..Xs.X</div>
<div class="line">[2022/11/24 08:54:57:9136] N: 0010: 24 82 2F 58 20 E5 2A E9 E8 AC 01 49 41 2E 3C EB    $./X .*....IA.&lt;.</div>
<div class="line">[2022/11/24 08:54:57:9136] N: 0020: E8 8D 6C B7 27 A9 DE D6 42 24 1A FD 39 D5 ED 0E    ..l.&#39;...B$..9...</div>
<div class="line">[2022/11/24 08:54:57:9136] N: 0030: 51 E8 9A 95 BF 58 4A D2 84 43 A1 01 26 A0 F6 58    Q....XJ..C..&amp;..X</div>
<div class="line">[2022/11/24 08:54:57:9136] N: 0040: 40 97 C2 E8 79 81 C5 23 6B 63 C5 AF 51 41 6C 43    @...y..#kc..QAlC</div>
<div class="line">[2022/11/24 08:54:57:9137] N: 0050: F6 9D E8 91 D7 EB AB 73 7A 30 52 A7 74 02 73 01    .......sz0R.t.s.</div>
<div class="line">[2022/11/24 08:54:57:9137] N: 0060: 0F B6 70 E2 0B 70 D8 3B CF C3 31 8A 26 39 D0 4D    ..p..p.;..1.&amp;9.M</div>
<div class="line">[2022/11/24 08:54:57:9137] N: 0070: 1F CF 4B 77 83 F3 24 7F 43 2E 9D 77 00 37 6B CC    ..Kw..$.C..w.7k.</div>
<div class="line">[2022/11/24 08:54:57:9137] N: 0080: E0 03 58 E1 A5 01 01 02 01 03 58 86 A2 02 81 84    ..X.......X.....</div>
<div class="line">[2022/11/24 08:54:57:9138] N: 0090: 4B 54 45 45 50 2D 44 65 76 69 63 65 48 53 65 63    KTEEP-DeviceHSec</div>
<div class="line">[2022/11/24 08:54:57:9138] N: 00A0: 75 72 65 46 53 50 8D 82 57 3A 92 6D 47 54 93 53    ureFSP..W:.mGT.S</div>
<div class="line">[2022/11/24 08:54:57:9138] N: 00B0: 32 DC 29 99 7F 74 42 74 61 04 58 56 86 14 A4 01    2.)..tBta.XV....</div>
<div class="line">[2022/11/24 08:54:57:9138] N: 00C0: 50 FA 6B 4A 53 D5 AD 5F DF BE 9D E6 63 E4 D4 1F    P.kJS.._....c...</div>
<div class="line">[2022/11/24 08:54:57:9139] N: 00D0: FE 02 50 14 92 AF 14 25 69 5E 48 BF 42 9B 2D 51    ..P....%i^H.B.-Q</div>
<div class="line">[2022/11/24 08:54:57:9139] N: 00E0: F2 AB 45 03 58 24 82 2F 58 20 00 11 22 33 44 55    ..E.X$./X ..&quot;3DU</div>
<div class="line">[2022/11/24 08:54:57:9139] N: 00F0: 66 77 88 99 AA BB CC DD EE FF 01 23 45 67 89 AB    fw.........#Eg..</div>
<div class="line">[2022/11/24 08:54:57:9140] N: 0100: CD EF FE DC BA 98 76 54 32 10 0E 19 87 D0 01 0F    ......vT2.......</div>
<div class="line">[2022/11/24 08:54:57:9140] N: 0110: 02 0F 09 58 4B 86 13 A1 15 78 41 68 74 74 70 3A    ...XK....xAhttp:</div>
<div class="line">[2022/11/24 08:54:57:9141] N: 0120: 2F 2F 31 32 37 2E 30 2E 30 2E 31 3A 38 38 38 38    //127.0.0.1:8888</div>
<div class="line">[2022/11/24 08:54:57:9141] N: 0130: 2F 54 41 73 2F 38 64 38 32 35 37 33 61 2D 39 32    /TAs/8d82573a-92</div>
<div class="line">[2022/11/24 08:54:57:9141] N: 0140: 36 64 2D 34 37 35 34 2D 39 33 35 33 2D 33 32 64    6d-4754-9353-32d</div>
<div class="line">[2022/11/24 08:54:57:9142] N: 0150: 63 32 39 39 39 37 66 37 34 2E 74 61 15 02 03 0F    c29997f74.ta....</div>
<div class="line">[2022/11/24 08:54:57:9142] N: 0160: 0A 43 82 03 0F 14 48 AB A1 A2 A3 A4 A5 A6 A7       .C....H........ </div>
<div class="line">[2022/11/24 08:54:57:9142] N: </div>
<div class="line">[2022/11/24 08:54:58:1626] N: GET: http://127.0.0.1:8888/TAs/8d82573a-926d-4754-9353-32dc29997f74.ta</div>
<div class="line">[2022/11/24 08:54:58:1630] N: http://127.0.0.1:8888/TAs/8d82573a-926d-4754-9353-32dc29997f74.ta</div>
<div class="line">[2022/11/24 08:54:58:3440] N: POST: http://192.168.100.114:8888/api/tam_cbor</div>
<div class="line">[2022/11/24 08:54:58:3441] N: </div>
<div class="line">[2022/11/24 08:54:58:3441] N: 0000: 82 05 A1 14 48 77 77 77 77 77 77 77 77             ....Hwwwwwwww   </div>
<div class="line">[2022/11/24 08:54:58:3441] N: </div>
<div class="line">[2022/11/24 08:54:58:3444] N: http://192.168.100.114:8888/api/tam_cbor</div>
<div class="line">[2022/11/24 08:54:58:3646] N: (hexdump: zero length)</div>
<div class="line">root@arm64-ubuntu:/home/user/teep-broker# </div>
</div><!-- fragment --><p ><b>Execute the ./hello-app</b></p>
<div class="fragment"><div class="line">$ ./hello-app</div>
<div class="line"> </div>
<div class="line"># Check for the &quot;Hello from TEE!&quot; output on Minicom window</div>
<div class="line">D/LD:  ldelf:134 Loading TA 68373894-5bb3-403c-9eec-3114a1f5d3fc</div>
<div class="line">D/TC:? 0 tee_ta_init_session_with_context:573 Re-open TA 3a2f8978-5dc0-11e8-9c2d-fa7ae01bbebc</div>
<div class="line">D/TC:? 0 system_open_ta_binary:257 Lookup user TA ELF 68373894-5bb3-403c-9eec-3114a1f5d3fc (Secure Storage TA)</div>
<div class="line">D/TC:? 0 system_open_ta_binary:260 res=0xffff0008</div>
<div class="line">D/TC:? 0 system_open_ta_binary:257 Lookup user TA ELF 68373894-5bb3-403c-9eec-3114a1f5d3fc (REE)</div>
<div class="line">D/TC:? 0 system_open_ta_binary:260 res=0x0</div>
<div class="line">D/LD:  ldelf:169 ELF (68373894-5bb3-403c-9eec-3114a1f5d3fc) at 0x4008c000</div>
<div class="line">D/TC:? 0 tee_ta_close_session:499 csess 0x101776c0 id 1</div>
<div class="line">D/TC:? 0 tee_ta_close_session:518 Destroy session</div>
<div class="line">M/TA: TTRC:verifying signature of suit manifest</div>
<div class="line">M/TA: TTRC:verify OK</div>
<div class="line">M/TA: TTRC:command: 20</div>
<div class="line">M/TA: TTRC:execute suit-set-parameters</div>
<div class="line">M/TA: TTRC:command: 1</div>
<div class="line">M/TA: TTRC:execute suit-condition-vendor-identifier</div>
<div class="line">M/TA: TTRC:command: 2</div>
<div class="line">M/TA: TTRC:execute suit-condition-class-identifier</div>
<div class="line">M/TA: TTRC:command: 19</div>
<div class="line">M/TA: TTRC:execute suit-set-parameters</div>
<div class="line">M/TA: TTRC:command: 21</div>
<div class="line">M/TA: TTRC:execute suit-directive-fetch</div>
<div class="line">M/TA: TTRC:fetch_and_store component</div>
<div class="line">M/TA: TTRC:component download 55976</div>
<div class="line">M/TA: TTRC:ta-store.c: store_component() store component</div>
<div class="line">M/TA: TTRC:  device   = TEEP-Device</div>
<div class="line">M/TA: TTRC:  storage  = SecureFS</div>
<div class="line">M/TA: TTRC:  filename = 8d82573a-926d-4754-9353-32dc29997f74.ta</div>
<div class="line">M/TA: TTRC:  image_len = 55976</div>
<div class="line">D/TC:? 0 tee_ta_init_pseudo_ta_session:283 Lookup pseudo TA 6e256cba-fc4d-4941-ad09-2ca1860342dd</div>
<div class="line">D/TC:? 0 tee_ta_init_pseudo_ta_session:296 Open secstor_ta_mgmt</div>
<div class="line">D/TC:? 0 tee_ta_init_pseudo_ta_session:310 secstor_ta_mgmt : 6e256cba-fc4d-4941-ad09-2ca1860342dd</div>
<div class="line">D/TC:? 0 install_ta:99 Installing 8d82573a-926d-4754-9353-32dc29997f74</div>
<div class="line">D/TC:? 0 tee_ta_close_session:499 csess 0x101769c0 id 1</div>
<div class="line">D/TC:? 0 tee_ta_close_session:518 Destroy session</div>
<div class="line">M/TA: TTRC:finish fetch</div>
<div class="line">M/TA: TTRC:command: 3</div>
<div class="line">M/TA: TTRC:execute suit-condition-image-match</div>
<div class="line">M/TA: TTRC:end of command seq</div>
<div class="line">D/TC:? 0 tee_ta_close_session:499 csess 0x10177ec0 id 1</div>
<div class="line">D/TC:? 0 tee_ta_close_session:518 Destroy session</div>
<div class="line">D/TC:? 0 destroy_context:298 Destroy TA ctx (0x10177e60)</div>
<div class="line">D/TC:? 0 tee_ta_init_pseudo_ta_session:283 Lookup pseudo TA 8d82573a-926d-4754-9353-32dc29997f74</div>
<div class="line">D/TC:? 0 load_ldelf:704 ldelf load address 0x40006000</div>
<div class="line">D/LD:  ldelf:134 Loading TA 8d82573a-926d-4754-9353-32dc29997f74</div>
<div class="line">D/TC:? 0 tee_ta_init_session_with_context:573 Re-open TA 3a2f8978-5dc0-11e8-9c2d-fa7ae01bbebc</div>
<div class="line">D/TC:? 0 system_open_ta_binary:257 Lookup user TA ELF 8d82573a-926d-4754-9353-32dc29997f74 (Secure Storage TA)</div>
<div class="line">D/TC:? 0 system_open_ta_binary:260 res=0x0</div>
<div class="line">D/LD:  ldelf:169 ELF (8d82573a-926d-4754-9353-32dc29997f74) at 0x40070000</div>
<div class="line">D/TC:? 0 tee_ta_close_session:499 csess 0x10176070 id 1</div>
<div class="line">D/TC:? 0 tee_ta_close_session:518 Destroy session</div>
<div class="line">Hello TEEP from TEE!</div>
<div class="line">D/TC:? 0 tee_ta_close_session:499 csess 0x10176870 id 1</div>
<div class="line">D/TC:? 0 tee_ta_close_session:518 Destroy session</div>
<div class="line">D/TC:? 0 destroy_context:298 Destroy TA ctx (0x10176810) </div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md46"></a>
SGX</h1>
<p >Instruction to build <code>TEEP-Device</code> with SGX. The SGX and its supporting sources must be built and installed on the build environment beforehand. Refer to the SGX section of the "Preparation before building TA-Ref without Docker" in the TA-Ref document.</p>
<h2><a class="anchor" id="autotoc_md47"></a>
Clone and Build</h2>
<p >As a preparation step, it is required to set up the Intel SGX SDK. Please refer to the preparation steps for building without Docker for SGX in TA-Ref documentation.</p>
<div class="fragment"><div class="line">$ source /opt/intel/sgxsdk/environment</div>
<div class="line">$ export TAREF_DIR=&lt;ta-ref dir&gt;</div>
</div><!-- fragment --><p >Clone and Build</p>
<div class="fragment"><div class="line"># Clone the TEEP-Device</div>
<div class="line">$ git clone https://github.com/mcd500/teep-device.git</div>
<div class="line">$ cd teep-device</div>
<div class="line">$ git checkout master</div>
<div class="line"> </div>
<div class="line"># Sync and update the submodules</div>
<div class="line">$ git submodule sync --recursive</div>
<div class="line">$ git submodule update --init --recursive</div>
<div class="line"> </div>
<div class="line"># Build the TEEP-Device</div>
<div class="line">$ export TEE=sgx</div>
<div class="line">$ make</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md48"></a>
Run hello-app &amp; teep-broker-app on Intel SGX</h2>
<p >To run TEEP-Device on SGX, confirm that the make is completed first and the tamproto is executed in another terminal.</p>
<p >Unlide Keystone and OP-TEE, it is directly executed on PC without using QEMU.</p>
<div class="fragment"><div class="line">$ cd ~/teep-device</div>
<div class="line">$ make run-sample-session</div>
</div><!-- fragment --><p >The output would contain the string <code>Hello TEEP from TEE!</code> The messages between TEEP-Device and tamproto are printed out as the log on the terminals.</p>
<div class="fragment"><div class="line">main start</div>
<div class="line">Hello TEEP from TEE!</div>
<div class="line">main end</div>
<div class="line">Info: Enclave successfully returned.</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md49"></a>
Generate Documentation</h1>
<p >This documentation (teep-device.pdf) is generated by using Doxygen. To install Doxygen the following procedure is necessary.</p>
<h2><a class="anchor" id="autotoc_md50"></a>
Required Packages</h2>
<p >Install the following packages on Ubuntu.</p>
<div class="fragment"><div class="line">$ sudo apt install doxygen-latex graphviz texlive-full texlive-latex-base latex-cjk-all</div>
</div><!-- fragment --><p >Above packages required to generate PDF using doxygen.</p>
<h2><a class="anchor" id="autotoc_md51"></a>
Build and Install Doxygen</h2>
<p >It is using a specific commit since we had a compatibility issue.</p>
<div class="fragment"><div class="line">$ git clone https://github.com/doxygen/doxygen.git</div>
<div class="line">$ cd doxygen</div>
<div class="line">$ git checkout 227952da7562a6f13da2a9d19c3cdc93812bc2de -b for-teep-device</div>
<div class="line">$ mkdir build</div>
<div class="line">$ cd build</div>
<div class="line">$ cmake -G &quot;Unix Makefiles&quot; ..</div>
<div class="line">$ make</div>
<div class="line">$ sudo make install</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md52"></a>
Generate pdf and html documentation</h2>
<div class="fragment"><div class="line">$ make docs</div>
</div><!-- fragment --><p >Location of created documentation.</p>
<div class="fragment"><div class="line">docs/teep-device.pdf</div>
<div class="line">docs/teep-device_readme_html.tar.gz</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
